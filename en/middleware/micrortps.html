
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>RTPS/ROS2 Interface Â· PX4 Developer Guide</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-dronecode/theme_styles.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="micrortps_throughput_test.html" />
    
    
    <link rel="prev" href="mavlink.html" />
    

    </head>
    <body>
        
    
    <!-- ##HW Add dronecode menu -->
    <div id="common_dronecode_menu">

      <div class="common_menu_logo large_version">
        <a href="https://www.dronecode.org/">
          <img src="../../gitbook/gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_full.png" alt="Dronecode logo (large)" />
        </a>
      </div>
      <div class="common_menu_logo small_version">
        <a href="https://www.dronecode.org/">
          <img src="../../gitbook/gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_small.png" alt="Dronecode logo (small)" />
        </a>
      </div>
      
      <div class="common_menu_options">
        
            <div class="common_dronecode_menu_item"><a href="http://px4.io/">PX4</a></div>
            <div class="common_dronecode_menu_item large_version"><a href="http://qgroundcontrol.com/">QGroundControl</a></div>
            <div class="common_dronecode_menu_item small_version"><a href="http://qgroundcontrol.com/">QGC</a></div>
            <div class="common_dronecode_menu_item"><a href="https://www.dronecode.org/sdk/">SDK</a></div>
            <div class="common_dronecode_menu_item"><a href="https://mavlink.io/en/">MAVLink</a></div>
            <div class="common_dronecode_menu_item large_version"><a href="https://www.dronecode.org/documentation/">Documentation</a></div>
            <div class="common_dronecode_menu_item small_version"><a href="https://www.dronecode.org/documentation/">Docs</a></div>
            <div class="common_dronecode_menu_item large_version"><a href="http://discuss.px4.io/">Support</a></div>
            <div class="common_dronecode_menu_item small_version"><a href="http://discuss.px4.io/">Help</a></div>
        
      </div>
    </div>
    
<!-- ##HW END Add dronecode menu -->
    
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../setup/getting_started.html">
            
                <a href="../setup/getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../setup/config_initial.html">
            
                <a href="../setup/config_initial.html">
            
                    
                    Initial Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../setup/dev_env.html">
            
                <a href="../setup/dev_env.html">
            
                    
                    Toolchain Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../setup/dev_env_mac.html">
            
                <a href="../setup/dev_env_mac.html">
            
                    
                    Mac OS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../setup/dev_env_linux.html">
            
                <a href="../setup/dev_env_linux.html">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.2.1" data-path="../setup/dev_env_linux_ubuntu.html">
            
                <a href="../setup/dev_env_linux_ubuntu.html">
            
                    
                    Ubuntu/Debian Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2.2" data-path="../setup/dev_env_linux_centos.html">
            
                <a href="../setup/dev_env_linux_centos.html">
            
                    
                    CentOS Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2.3" data-path="../setup/dev_env_linux_arch.html">
            
                <a href="../setup/dev_env_linux_arch.html">
            
                    
                    Arch Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2.4" data-path="../setup/dev_env_advanced_linux.html">
            
                <a href="../setup/dev_env_advanced_linux.html">
            
                    
                    Advanced Linux
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../setup/dev_env_windows.html">
            
                <a href="../setup/dev_env_windows.html">
            
                    
                    Windows
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.3.1" data-path="../setup/dev_env_windows_cygwin.html">
            
                <a href="../setup/dev_env_windows_cygwin.html">
            
                    
                    Cygwin Toolchain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3.2" data-path="../setup/dev_env_windows_vm.html">
            
                <a href="../setup/dev_env_windows_vm.html">
            
                    
                    Virtual Machine Toolchain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3.3" data-path="../setup/dev_env_windows_bash_on_win.html">
            
                <a href="../setup/dev_env_windows_bash_on_win.html">
            
                    
                    Bash on Windows Toolchain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3.4" data-path="../setup/dev_env_windows_msys.html">
            
                <a href="../setup/dev_env_windows_msys.html">
            
                    
                    Msys Toolchain
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../setup/fast-rtps-installation.html">
            
                <a href="../setup/fast-rtps-installation.html">
            
                    
                    Fast RTPS installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../setup/generic_dev_tools.html">
            
                <a href="../setup/generic_dev_tools.html">
            
                    
                    Additional Tools
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../setup/building_px4.html">
            
                <a href="../setup/building_px4.html">
            
                    
                    Building the Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../apps/hello_sky.html">
            
                <a href="../apps/hello_sky.html">
            
                    
                    Writing your First Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../apps/module_template.html">
            
                <a href="../apps/module_template.html">
            
                    
                    Application/Module Template
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../concept/">
            
                <a href="../concept/">
            
                    
                    Concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../concept/architecture.html">
            
                <a href="../concept/architecture.html">
            
                    
                    PX4 Architectural Overview
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../flight_stack/controller_diagrams.html">
            
                <a href="../flight_stack/controller_diagrams.html">
            
                    
                    Controller Diagrams
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../concept/dronecode_architecture.html">
            
                <a href="../concept/dronecode_architecture.html">
            
                    
                    Dronecode Platform Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../concept/flight_modes.html">
            
                <a href="../concept/flight_modes.html">
            
                    
                    Flight Modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../concept/mixing.html">
            
                <a href="../concept/mixing.html">
            
                    
                    Mixing and Actuators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../concept/pwm_limit.html">
            
                <a href="../concept/pwm_limit.html">
            
                    
                    PWM limit state machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../concept/system_startup.html">
            
                <a href="../concept/system_startup.html">
            
                    
                    System Startup
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../simulation/">
            
                <a href="../simulation/">
            
                    
                    Simulation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../simulation/jmavsim.html">
            
                <a href="../simulation/jmavsim.html">
            
                    
                    jMAVSim Simulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../simulation/gazebo.html">
            
                <a href="../simulation/gazebo.html">
            
                    
                    Gazebo Simulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../simulation/airsim.html">
            
                <a href="../simulation/airsim.html">
            
                    
                    AirSim Simulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../simulation/multi_vehicle_jmavsim.html">
            
                <a href="../simulation/multi_vehicle_jmavsim.html">
            
                    
                    Multi-Vehicle Sim with JMAVSim
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../simulation/multi-vehicle-simulation.html">
            
                <a href="../simulation/multi-vehicle-simulation.html">
            
                    
                    Multi-Vehicle Sim with Gazebo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../simulation/hitl.html">
            
                <a href="../simulation/hitl.html">
            
                    
                    HITL Simulation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../hardware/">
            
                <a href="../hardware/">
            
                    
                    Hardware
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../debug/reference-design.html">
            
                <a href="../debug/reference-design.html">
            
                    
                    Flight Controller Reference Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../hardware/porting_guide.html">
            
                <a href="../hardware/porting_guide.html">
            
                    
                    Flight Controller Porting Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../airframes/">
            
                <a href="../airframes/">
            
                    
                    Airframes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../airframes/airframe_reference.html">
            
                <a href="../airframes/airframe_reference.html">
            
                    
                    Airframes Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../airframes/adding_a_new_frame.html">
            
                <a href="../airframes/adding_a_new_frame.html">
            
                    
                    Adding a New Airframe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="drivers.html">
            
                <a href="drivers.html">
            
                    
                    Device Drivers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../data_links/telemetry.html">
            
                <a href="../data_links/telemetry.html">
            
                    
                    Telemetry Radio
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.5.1" data-path="../data_links/sik_radio.html">
            
                <a href="../data_links/sik_radio.html">
            
                    
                    SiK Radio
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../sensor_bus/">
            
                <a href="../sensor_bus/">
            
                    
                    Sensor and Actuator I/O
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.1" data-path="../sensor_bus/i2c.html">
            
                <a href="../sensor_bus/i2c.html">
            
                    
                    I2C Bus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2" data-path="../uavcan/">
            
                <a href="../uavcan/">
            
                    
                    UAVCAN Bus
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.2.1" data-path="../uavcan/bootloader_installation.html">
            
                <a href="../uavcan/bootloader_installation.html">
            
                    
                    UAVCAN Bootloader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.2" data-path="../uavcan/node_firmware.html">
            
                <a href="../uavcan/node_firmware.html">
            
                    
                    UAVCAN Firmware Upgrades
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.3" data-path="../uavcan/node_enumeration.html">
            
                <a href="../uavcan/node_enumeration.html">
            
                    
                    UAVCAN Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.4" data-path="../uavcan/notes.html">
            
                <a href="../uavcan/notes.html">
            
                    
                    UAVCAN Various Notes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6.3" data-path="../uart/">
            
                <a href="../uart/">
            
                    
                    UART/Serial Ports
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.3.1" data-path="../uart/user_configurable_serial_driver.html">
            
                <a href="../uart/user_configurable_serial_driver.html">
            
                    
                    Port-Configurable Serial Drivers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../advanced/rtk_gps.html">
            
                <a href="../advanced/rtk_gps.html">
            
                    
                    RTK GPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../advanced/gimbal_control.html">
            
                <a href="../advanced/gimbal_control.html">
            
                    
                    Gimbal (Mount) Control Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../companion_computer/pixhawk_companion.html">
            
                <a href="../companion_computer/pixhawk_companion.html">
            
                    
                    Companion Computers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                    Middleware
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="uorb.html">
            
                <a href="uorb.html">
            
                    
                    uORB Messaging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="uorb_graph.html">
            
                <a href="uorb_graph.html">
            
                    
                    uORB Graph
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="mavlink.html">
            
                <a href="mavlink.html">
            
                    
                    MAVLink Messaging
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.4" data-path="micrortps.html">
            
                <a href="micrortps.html">
            
                    
                    RTPS/ROS2 Interface
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.1" data-path="micrortps_throughput_test.html">
            
                <a href="micrortps_throughput_test.html">
            
                    
                    Throughput Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4.2" data-path="micrortps_manual_code_generation.html">
            
                <a href="micrortps_manual_code_generation.html">
            
                    
                    Manually Generate Client/Agent
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="modules_main.html">
            
                <a href="modules_main.html">
            
                    
                    Modules & Commands
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="modules_command.html">
            
                <a href="modules_command.html">
            
                    
                    Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="modules_communication.html">
            
                <a href="modules_communication.html">
            
                    
                    Communication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="modules_controller.html">
            
                <a href="modules_controller.html">
            
                    
                    Controllers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="modules_driver.html">
            
                <a href="modules_driver.html">
            
                    
                    Drivers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="modules_estimator.html">
            
                <a href="modules_estimator.html">
            
                    
                    Estimators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="modules_system.html">
            
                <a href="modules_system.html">
            
                    
                    System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="modules_template.html">
            
                <a href="modules_template.html">
            
                    
                    Template
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../robotics/">
            
                <a href="../robotics/">
            
                    
                    Robotics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../ros/offboard_control.html">
            
                <a href="../ros/offboard_control.html">
            
                    
                    Offboard Control from Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../ros/">
            
                <a href="../ros/">
            
                    
                    ROS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="../ros/mavros_installation.html">
            
                <a href="../ros/mavros_installation.html">
            
                    
                    MAVROS (MAVLink on ROS)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="../ros/mavros_offboard.html">
            
                <a href="../ros/mavros_offboard.html">
            
                    
                    MAVROS Offboard Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="../simulation/ros_interface.html">
            
                <a href="../simulation/ros_interface.html">
            
                    
                    ROS with Gazebo Simulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.4" data-path="../simulation/gazebo_octomap.html">
            
                <a href="../simulation/gazebo_octomap.html">
            
                    
                    OctoMap Models with ROS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.5" data-path="../ros/raspberrypi_installation.html">
            
                <a href="../ros/raspberrypi_installation.html">
            
                    
                    ROS Installation on RPi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.6" data-path="../ros/external_position_estimation.html">
            
                <a href="../ros/external_position_estimation.html">
            
                    
                    External Position Estimation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../robotics/dronekit.html">
            
                <a href="../robotics/dronekit.html">
            
                    
                    DroneKit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../debug/">
            
                <a href="../debug/">
            
                    
                    Debugging/Logging
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../debug/faq.html">
            
                <a href="../debug/faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../debug/system_console.html">
            
                <a href="../debug/system_console.html">
            
                    
                    System Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../debug/gdb_debugging.html">
            
                <a href="../debug/gdb_debugging.html">
            
                    
                    Autopilot Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../debug/sensor_uorb_topic_debugging.html">
            
                <a href="../debug/sensor_uorb_topic_debugging.html">
            
                    
                    Sensor/Topic Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../debug/simulation_debugging.html">
            
                <a href="../debug/simulation_debugging.html">
            
                    
                    Simulation Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../debug/debug_values.html">
            
                <a href="../debug/debug_values.html">
            
                    
                    Sending Debug Values
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../debug/system_wide_replay.html">
            
                <a href="../debug/system_wide_replay.html">
            
                    
                    System-wide Replay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../debug/profiling.html">
            
                <a href="../debug/profiling.html">
            
                    
                    Profiling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../log/logging.html">
            
                <a href="../log/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../log/flight_log_analysis.html">
            
                <a href="../log/flight_log_analysis.html">
            
                    
                    Flight Log Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../log/ulog_file_format.html">
            
                <a href="../log/ulog_file_format.html">
            
                    
                    ULog File Format
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../tutorials/tutorials.html">
            
                <a href="../tutorials/tutorials.html">
            
                    
                    Tutorials
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../qgc/">
            
                <a href="../qgc/">
            
                    
                    Ground Control Station
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../qgc/video_streaming.html">
            
                <a href="../qgc/video_streaming.html">
            
                    
                    Video Streaming in QGC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../qgc/video_streaming_wifi_broadcast.html">
            
                <a href="../qgc/video_streaming_wifi_broadcast.html">
            
                    
                    Long-distance Video Streaming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../tutorials/tuning_the_ecl_ekf.html">
            
                <a href="../tutorials/tuning_the_ecl_ekf.html">
            
                    
                    ecl EKF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../tutorials/motion-capture-vicon-optitrack.html">
            
                <a href="../tutorials/motion-capture-vicon-optitrack.html">
            
                    
                    Motion Capture (VICON, Optitrack)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../tutorials/linux_sbus.html">
            
                <a href="../tutorials/linux_sbus.html">
            
                    
                    S.Bus Driver for Linux
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../advanced/">
            
                <a href="../advanced/">
            
                    
                    Advanced Topics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../advanced/parameters_and_configurations.html">
            
                <a href="../advanced/parameters_and_configurations.html">
            
                    
                    Parameters & Configs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../advanced/parameter_reference.html">
            
                <a href="../advanced/parameter_reference.html">
            
                    
                    Parameter Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../advanced/realsense_intel_driver.html">
            
                <a href="../advanced/realsense_intel_driver.html">
            
                    
                    Installing driver for Intel RealSense R200
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../advanced/switching_state_estimators.html">
            
                <a href="../advanced/switching_state_estimators.html">
            
                    
                    Switching State Estimators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../advanced/out_of_tree_modules.html">
            
                <a href="../advanced/out_of_tree_modules.html">
            
                    
                    Out-of-Tree Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="../software_update/stm32_bootloader.html">
            
                <a href="../software_update/stm32_bootloader.html">
            
                    
                    STM32 Bootloader
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../test_and_ci/">
            
                <a href="../test_and_ci/">
            
                    
                    Platform Testing and CI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../test_and_ci/test_flights.html">
            
                <a href="../test_and_ci/test_flights.html">
            
                    
                    Test Flights
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1.1" data-path="../test_cards/mc_01_manual_modes.html">
            
                <a href="../test_cards/mc_01_manual_modes.html">
            
                    
                    Test MC_01 - Manual Modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.2" data-path="../test_cards/mc_02_full_autonomous.html">
            
                <a href="../test_cards/mc_02_full_autonomous.html">
            
                    
                    Test MC_02 - Full Autonomous
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.3" data-path="../test_cards/mc_03_auto_manual_mix.html">
            
                <a href="../test_cards/mc_03_auto_manual_mix.html">
            
                    
                    Test MC_03 - Auto Manual Mix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.4" data-path="../test_cards/mc_04_failsafe_testing.html">
            
                <a href="../test_cards/mc_04_failsafe_testing.html">
            
                    
                    Test MC_04 - Failsafe Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.5" data-path="../test_cards/mc_05_indoor_flight_manual_modes.html">
            
                <a href="../test_cards/mc_05_indoor_flight_manual_modes.html">
            
                    
                    Test MC_05 - Indoor Flight (Manual Modes)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../test_and_ci/unit_tests.html">
            
                <a href="../test_and_ci/unit_tests.html">
            
                    
                    Unit Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../test_and_ci/continous_integration.html">
            
                <a href="../test_and_ci/continous_integration.html">
            
                    
                    Continuous Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../test_and_ci/jenkins_ci.html">
            
                <a href="../test_and_ci/jenkins_ci.html">
            
                    
                    Jenkins Continuous Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../test_and_ci/integration_testing.html">
            
                <a href="../test_and_ci/integration_testing.html">
            
                    
                    Integration Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../test_and_ci/docker.html">
            
                <a href="../test_and_ci/docker.html">
            
                    
                    Docker Containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../test_and_ci/maintenance.html">
            
                <a href="../test_and_ci/maintenance.html">
            
                    
                    Maintenance
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../contribute/">
            
                <a href="../contribute/">
            
                    
                    Contributing & Dev Call
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../contribute/git_examples.html">
            
                <a href="../contribute/git_examples.html">
            
                    
                    GIT Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../contribute/docs.html">
            
                <a href="../contribute/docs.html">
            
                    
                    Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../contribute/notation.html">
            
                <a href="../contribute/notation.html">
            
                    
                    Terminology/Notation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="../contribute/licenses.html">
            
                <a href="../contribute/licenses.html">
            
                    
                    Licenses
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Dronecode Shortcuts</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://docs.px4.io/en/">
            
                    
                    PX4 User Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <a target="_blank" href="https://docs.qgroundcontrol.com/en/">
            
                    
                    QGroundControl User Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <a target="_blank" href="https://dev.qgroundcontrol.com/en/">
            
                    
                    QGroundControl Developer Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <a target="_blank" href="https://mavlink.io/en/">
            
                    
                    MAVLink Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <a target="_blank" href="https://sdk.dronecode.org/en/">
            
                    
                    Dronecode SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" >
            
                <a target="_blank" href="https://camera-manager.dronecode.org/en/">
            
                    
                    Dronecode Camera Manager
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >RTPS/ROS2 Interface</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="rtpsros2-interface-px4-fastrtps-bridge">RTPS/ROS2 Interface: PX4-FastRTPS Bridge</h1>
<p>The <em>PX4-FastRTPS Bridge</em> adds a Real Time Publish Subscribe (RTPS) interface to PX4, enabling the exchange of <a href="uorb.html">uORB messages</a> between PX4 components and (offboard) <em>Fast RTPS</em> applications (including those built using the ROS2/ROS frameworks).</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> RTPS is the underlying protocol of the Object Management Group&apos;s (OMG) Data Distribution Service (DDS) standard. 
  It aims to enable scalable, real-time, dependable, high-performance and inter-operable data communication using the publish/subscribe pattern. <em>Fast RTPS</em> is a very lightweight cross-platform implementation of the latest version of the RTPS protocol and a minimum DDS API.</p>
</blockquote>
<p>RTPS has been adopted as the middleware for the ROS2 (Robot Operating System).
The <em>Fast RTPS bridge</em> allows us to better integrate with ROS2, making it easy to share sensor values, commands, and other vehicle information.</p>
<p>This topic describes the RTPS bridge architecture (and how it is used within the ROS2/ROS application pipeline).
It also shows how to compile needed code to:</p>
<ol>
<li>Write a simple <em>Fast RTPS</em> application to subscribe to PX4 changes</li>
<li>Connect ROS2 nodes with PX4 (via the RTPS Bridge, and using the <code>px4_ros_com</code> package)</li>
<li>Connect ROS (ROS &quot;version 1&quot;) nodes with PX4 by additionally using the <code>ros1_bridge</code> package to bridge ROS2 and ROS.</li>
</ol>
<h2 id="when-should-rtps-be-used">When should RTPS be used?</h2>
<p>RTPS should be used when you need to reliably share time-critical/real-time information between the flight controller and off board components.
In particular it is useful in cases where off-board software needs to become a <em>peer</em> of software components running in PX4 (by sending and receiving uORB topics).</p>
<p>Possible use cases include communicating with robotics libraries for computer vision, and other use cases where real time data to/from actuators and sensors is essential for vehicle control.</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> <em>Fast RTPS</em> is not intended as a replacement for MAVLink. 
  MAVLink remains the most appropriate protocol for communicating with ground stations, gimbals, cameras, and other offboard components (although <em>Fast RTPS</em> may open other opportunities for working with some peripherals).</p>
</blockquote>
<p><span></span></p>
<blockquote class="clearfix alert alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong>
<p> RTPS can be used over slower links (e.g. radio telemetry), but care should be taken not to overload the channel.</p>
</blockquote>
<h2 id="architectural-overview">Architectural overview</h2>
<h3 id="rtps-bridge">RTPS Bridge</h3>
<p>The RTPS bridge exchanges messages between PX4 and RTPS applications, seamlessly converting between the <a href="uorb.html">uORB</a> and RTPS messages used by each system.</p>
<p><img src="../../assets/middleware/micrortps/architecture.png" alt="basic example flow"></p>
<p>The main elements of the architecture are the client and agent processes shown in the diagram above.</p>
<ul>
<li>The <em>Client</em> is PX4 middleware daemon process that runs on the flight controller. 
It subscribes to uORB topics published by other PX4 components and sends any updates to the <em>Agent</em> (via a UART or UDP port). 
It also receives messages from the <em>Agent</em> and publishes them as uORB message on PX4.</li>
<li>The <em>Agent</em> runs as a daemon process on an offboard computer. 
It watches for uORB update messages from the <em>Client</em> and (re)publishes them over RTPS. 
It also subscribes to &quot;uORB&quot; RTPS messages from other RTPS applications and forwards them to the <em>Client</em>.</li>
<li>The <em>Agent</em> and <em>Client</em> are connected via a serial link (UART) or UDP network. 
The uORB information is <a href="https://en.wikipedia.org/wiki/Common_Data_Representation" target="_blank">CDR serialized</a> for sending (<em>CDR serialization</em> provides a common format for exchanging serial data between different platforms).</li>
<li>The <em>Agent</em> and any <em>Fast RTPS</em> applications are connected via UDP, and may be on the same or another device. 
In a typical configuration they will both be on the same system (e.g. a development computer, Linux companion computer or compute board), connected to the <em>Client</em> over a Wifi link or via USB.</li>
</ul>
<h3 id="ros2ros-application-pipeline">ROS2/ROS application pipeline</h3>
<p>The application pipeline for ROS2 is very straightforward! 
Because ROS2 uses DDS/RTPS as its native communications middleware, you can create a ROS2 listener or advertiser node to publish and subscribe to uORB data on PX4, via the <em>PX4 Fast RTPS Bridge</em>. This is shown below.</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> You do need to make sure that the message types, headers and source files used on both client and agent side (and consequently, on the ROS nodes) are generated from the same Interface Description Language (IDL) files. The <code>px4_ros_com</code> package provides the needed infrastructure for generating messages and headers needed by ROS2.</p>
</blockquote>
<p><img src="../../assets/middleware/micrortps/architecture_ros2.png" alt="Architecture with ROS2"></p>
<p>The architecture for integrating ROS applications with PX4 is shown below.</p>
<p><img src="../../assets/middleware/micrortps/architecture_ros.png" alt="Architecture with ROS"></p>
<p>Note the use of <a href="https://github.com/ros2/ros1_bridge" target="_blank">ros1_bridge</a>, which bridges messages between ROS2 and ROS.
This is needed because the first version of ROS does not support RTPS.</p>
<h2 id="code-generation">Code generation</h2>
<h3 id="ros-independent-applications">ROS-independent applications</h3>
<p>All the code needed to create, build and use the bridge is automatically generated when the PX4 Firmware is compiled.</p>
<p>The <em>Client</em> application is also compiled and built into the firmware as part of the normal build process. 
The <em>Agent</em> must be separately/manually compiled for the target computer.</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> <a href="../setup/fast-rtps-installation.html">Fast RTPS must be installed</a> in order to generate the required code!</p>
</blockquote>
<p><span></span></p>
<blockquote class="clearfix alert alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong>
<p> The bridge code can also be <a href="micrortps_manual_code_generation.html">manually generated</a>. 
  Most users will not need to do so, but the linked topic provides a more detailed overview of the build process and can be useful for troubleshooting.</p>
</blockquote>
<h3 id="px4_ros_com">ROS2/ROS applications </h3>
<p>The <a href="https://github.com/PX4/px4_ros_com" target="_blank">px4_ros_com</a> package, when built, generates everything needed to access PX4 uORB messages from a ROS2 node (for ROS you also need <a href="https://github.com/ros2/ros1_bridge" target="_blank">ros1_bridge</a>).
This includes all the required components of the *PX4 RTPS bridge, including the IDL files (required by the <code>micrortps_agent</code>), the <code>micrortps_agent</code> itself and the sources and headers of the ROS messages.</p>
<p>The package has two separate branches:</p>
<ul>
<li>a <code>master</code> branch, used with ROS2. It contains code to generate all the required ROS2 messages and IDL files to bridge PX4 with ROS2 nodes.</li>
<li>a <code>ros1</code> branch, used with ROS. It contains code to generate the ROS message headers and source files, which can be used <em>with</em> the <code>ros1_bridge</code> to share data between PX4 and ROS.</li>
</ul>
<p>Both branches additionally include some example listener and advertiser example nodes.</p>
<h2 id="supported-uorb-messages">Supported uORB messages</h2>
<p>The generated bridge code will enable a specified subset of uORB topics to be published/subscribed via RTPS. 
This is true for both ROS or non-ROS applications.</p>
<p>For <em>automatic code generation</em> there&apos;s a <em>yaml</em> definition file in the PX4 <strong>Firmware/msg/tools/</strong> directory called <strong>uorb_rtps_message_ids.yaml</strong>. This file defines the set of uORB messages to be used with RTPS, whether the messages are to be sent, received or both, and the RTPS ID for the message to be used in DDS/RTPS middleware.</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> An RTPS ID must be set for all messages.</p>
</blockquote>
<pre><code class="lang-yaml"><span class="hljs-attr">rtps:</span>
<span class="hljs-attr">  - msg:</span> actuator_armed
<span class="hljs-attr">    id:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">  - msg:</span> actuator_control
<span class="hljs-attr">    id:</span> <span class="hljs-number">1</span>
<span class="hljs-bullet">  -</span> ...
<span class="hljs-attr">  - msg:</span> airspeed
<span class="hljs-attr">    id:</span> <span class="hljs-number">5</span>
<span class="hljs-attr">    send:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  - msg:</span> battery_status
<span class="hljs-attr">    id:</span> <span class="hljs-number">6</span>
<span class="hljs-attr">    send:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  - msg:</span> camera_capture
<span class="hljs-attr">    id:</span> <span class="hljs-number">7</span>
<span class="hljs-attr">  - msg:</span> camera_trigger
<span class="hljs-attr">    id:</span> <span class="hljs-number">8</span>
<span class="hljs-attr">    receive:</span> <span class="hljs-literal">true</span>
<span class="hljs-bullet">  -</span> ...
<span class="hljs-attr">  - msg:</span> sensor_baro
<span class="hljs-attr">    id:</span> <span class="hljs-number">63</span>
<span class="hljs-attr">    receive:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">    send:</span> <span class="hljs-literal">true</span>
</code></pre>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> The <code>px4_ros_com</code> build process (only) runs the CMake macro <code>rosidl_generate_interfaces()</code> to generate ROS2 IDL files and all the source and header files for each message.
The PX4 Firmware includes a template for the IDL file generation, which is only used during the PX4 build process. </p>
<p>The <code>px4_ros_com</code> build generates <em>slightly different</em> IDL files for use with ROS2/ROS (than are built for PX4 firmware). 
The <strong>uorb_rtps_message_ids.yaml</strong> is transformed in a way that the message names become <em>PascalCased</em>
(the name change is irrelevant to the client-agent communication, but is critical for ROS2, since the message naming must follow the PascalCase convention). 
The new IDL files also reverse the messages that are sent and received 
(required because if a message is sent from the client side, then it&apos;s received on the agent side, and vice-versa). </p>
</blockquote>
<h2 id="client_firmware">Client (PX4 Firmware) </h2>
<p>The <em>Client</em> source code is generated, compiled and built into the PX4 firmware as part of the normal build process.</p>
<p>To build the firmware for NuttX/Pixhawk flight controllers use the <code>_rtps</code> feature in the configuration target.
For example, to build RTPS for px4_fmu-v4:</p>
<pre><code class="lang-sh">make px4_fmu-v4_rtps
</code></pre>
<p>To build the firmware for a SITL target:</p>
<pre><code class="lang-sh">make px4_sitl_rtps
</code></pre>
<p>The <em>Client</em> application can be launched from <a href="../debug/system_console.html">NuttShell/System Console</a>.
The command syntax is shown below (you can specify a variable number of arguments):</p>
<pre><code class="lang-sh">&gt; micrortps_client start|stop [options]
  -t &lt;transport&gt;          [UART|UDP] Default UART
  <span class="hljs-_">-d</span> &lt;device&gt;             UART device. Default /dev/ttyACM0
  -u &lt;update_time_ms&gt;     Time <span class="hljs-keyword">in</span> ms <span class="hljs-keyword">for</span> uORB subscribed topics update. Default 0
  <span class="hljs-_">-l</span> &lt;loops&gt;              How many iterations will this program have. -1 <span class="hljs-keyword">for</span> infinite. Default -1.
  -w &lt;sleep_time_ms&gt;      Time <span class="hljs-keyword">in</span> ms <span class="hljs-keyword">for</span> <span class="hljs-built_in">which</span> each iteration sleep. Default 1ms
  -b &lt;baudrate&gt;           UART device baudrate. Default 460800
  -p &lt;poll_ms&gt;            Time <span class="hljs-keyword">in</span> ms to poll over UART. Default 1ms
  -r &lt;reception port&gt;     UDP port <span class="hljs-keyword">for</span> receiving. Default 2019
  <span class="hljs-_">-s</span> &lt;sending port&gt;       UDP port <span class="hljs-keyword">for</span> sending. Default 2020
</code></pre>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> By default the <em>Client</em> runs as a daemon, but you will need to start it manually. 
  The PX4 Firmware initialization code may in future automatically start the <em>Client</em> as a permanent daemon process.</p>
</blockquote>
<p>For example, in order to run the <em>Client</em> daemon with SITL connecting to the Agent via UDP, start the daemon as shown:</p>
<pre><code class="lang-sh">micrortps_client start -t UDP
</code></pre>
<h2 id="agent-in-a-ros-independent-offboard-fast-rtps-interface">Agent in a ROS-independent Offboard Fast RTPS interface</h2>
<p>The <em>Agent</em> code is automatically <em>generated</em> when you build the associated PX4 firmware. 
You can find the source here: <strong>build/<target-platform>/src/modules/micrortps_bridge/micrortps_client/micrortps_agent/</target-platform></strong>.</p>
<p>To build the <em>Agent</em> application, compile the code:</p>
<pre><code class="lang-sh"><span class="hljs-built_in">cd</span> build/&lt;target-platform&gt;/src/modules/micrortps_bridge/micrortps_client/micrortps_agent
mkdir build &amp;&amp; <span class="hljs-built_in">cd</span> build
cmake ..
make
</code></pre>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> To cross-compile for the <em>Qualcomm Snapdragon Flight</em> platform see <a href="https://github.com/eProsima/PX4-FastRTPS-PoC-Snapdragon-UDP#how-to-use" target="_blank">this link</a>.</p>
</blockquote>
<p>The command syntax for the <em>Agent</em> is listed below:</p>
<pre><code class="lang-sh">$ ./micrortps_agent [options]
  -t &lt;transport&gt;          [UART|UDP] Default UART.
  <span class="hljs-_">-d</span> &lt;device&gt;             UART device. Default /dev/ttyACM0.
  -w &lt;sleep_time_us&gt;      Time <span class="hljs-keyword">in</span> us <span class="hljs-keyword">for</span> <span class="hljs-built_in">which</span> each iteration sleep. Default 1ms.
  -b &lt;baudrate&gt;           UART device baudrate. Default 460800.
  -p &lt;poll_ms&gt;            Time <span class="hljs-keyword">in</span> ms to poll over UART. Default 1ms.
  -r &lt;reception port&gt;     UDP port <span class="hljs-keyword">for</span> receiving. Default 2019.
  <span class="hljs-_">-s</span> &lt;sending port&gt;       UDP port <span class="hljs-keyword">for</span> sending. Default 2020.
</code></pre>
<p>To launch the <em>Agent</em>, run <code>micrortps_agent</code> with appropriate options for specifying the connection to the <em>Client</em> (the default options connect from a Linux device to the <em>Client</em> over a UART port).</p>
<p>As an example, to start the <em>micrortps_agent</em> with connection through UDP, issue:</p>
<pre><code class="lang-sh">./micrortps_agent -t UDP
</code></pre>
<h2 id="agent-interfacing-with-a-ros2-middleware">Agent interfacing with a ROS2 middleware</h2>
<p>Building <code>px4_ros_com</code> automatically generates and builds the agent application. 
Since it is also installed using the <a href="http://design.ros2.org/articles/build_tool.html" target="_blank"><code>colcon</code></a> build tools, running it works exactly the same way as the above. 
Check the <strong>Building the <code>px4_ros_com</code> package</strong> for details about the build structure.</p>
<h2 id="building-the-px4roscom-package">Building the <code>px4_ros_com</code> package</h2>
<p>Before building <code>px4_ros_com</code> you will first need to clone the PX4 Firmware repository
(this is normally placed at the same tree level as the ROS workspaces).
Then install and setup both ROS2 and ROS environments on your development machine
and separately clone the <code>px4_ros_com</code> repo for both the <code>master</code> and <code>ros1</code> branches (see <a href="#px4_ros_com">above for more information</a>).</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> Only the master branch is needed for ROS2 (both are needed to target ROS). </p>
</blockquote>
<h3 id="installing-ros-and-ros2-and-respective-dependencies">Installing ROS and ROS2 and respective dependencies</h3>
<p>In order to install ROS Melodic and ROS2 Bouncy on a Ubuntu 18.04 machine, follow the links below, respectively:</p>
<ol>
<li><a href="http://wiki.ros.org/melodic/Installation/Ubuntu" target="_blank">Install ROS Melodic</a></li>
<li><a href="https://index.ros.org/doc/ros2/Linux-Install-Debians/" target="_blank">Install ROS2 Bouncy</a></li>
</ol>
<p>Install the following component to ensure that the package properly generates the IDL files:</p>
<pre><code class="lang-sh">sudo apt install ros-bouncy-rmw-opensplice-cpp
</code></pre>
<p>The install process should also install the <code>colcon</code> build tools, but in case that doesn&apos;t happen, you can install the tools manually:</p>
<pre><code class="lang-sh">sudo apt install python3-colcon-common-extensions
</code></pre>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> This install and build guide is also applicable in an environment with Ubuntu 16.04, ROS Kinetic and ROS2 Ardent installed.</p>
</blockquote>
<p><span></span></p>
<blockquote class="clearfix alert alert-warning"><strong class="fa fa-2x fa-exclamation-triangle"></strong>
<p> Do not install the <code>ros1_bridge</code> package through the deb repository. 
  The package must be built from source.</p>
</blockquote>
<h3 id="setting-up-the-workspaces">Setting up the workspaces</h3>
<p>Since the ROS2 and ROS require different environments you will need a separate workspace for each ROS version.
As an example:</p>
<ol>
<li><p>For ROS2, create a workspace using:</p>
<pre><code class="lang-sh">mkdir -p ~/px4_ros_com_ros2/src
</code></pre>
<p>Then, clone the respective ROS2 (<code>master</code>) branch to the <code>/src</code> directory:</p>
<pre><code class="lang-sh">$ git <span class="hljs-built_in">clone</span> https://github.com/PX4/px4_ros_com.git ~/px4_ros_com_ros2/src/px4_ros_com <span class="hljs-comment"># clones the master branch</span>
</code></pre>
</li>
<li><p>For ROS, follow exactly the same process, but create a different directory and clone a different branch:</p>
<pre><code class="lang-sh">mkdir -p ~/px4_ros_com_ros1/src
</code></pre>
<p>Then, clone the respective ROS2 (<code>master</code>) branch to the <code>/src</code> directory:</p>
<pre><code class="lang-sh">$ git <span class="hljs-built_in">clone</span> https://github.com/PX4/px4_ros_com.git ~/px4_ros_com_ros1/src/px4_ros_com <span class="hljs-comment"># clones the &apos;ros1&apos; branch</span>
</code></pre>
</li>
</ol>
<h3 id="building-the-workspaces">Building the workspaces</h3>
<p>To build the workspace, just run <code>build_ros2_side.bash</code> (in directory <code>px4_ros_com/scripts</code>).</p>
<p>The steps below show how to <em>manually</em> build the packages (provided for your information/better understanding only):</p>
<ol>
<li><p><code>cd</code> into <code>px4_ros_com_ros2</code> dir and source the ROS2 environment. 
Don&apos;t mind if it tells you that a previous workspace was set before:</p>
<pre><code class="lang-sh"><span class="hljs-built_in">source</span> /opt/ros/bouncy/setup.bash
</code></pre>
</li>
<li><p>Clone the <code>ros1_bridge</code> package so it can be built on the ROS2 workspace:</p>
<pre><code class="lang-sh">git <span class="hljs-built_in">clone</span> https://github.com/ros2/ros1_bridge.git ~/px4_ros_com_ros2/src/ros1_bridge
</code></pre>
</li>
<li><p>Build the <code>px4_ros_com</code> package, excluding the <code>ros1_bridge</code> package:</p>
<pre><code class="lang-sh">colcon build --symlink-install --packages-skip ros1_bridge --event-handlers console_direct+
</code></pre>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> <code>--event-handlers console_direct+</code> only serves the purpose of adding verbosity to the <code>colcon</code> build process and can be removed if one wants a more &quot;quiet&quot; build.</p>
</blockquote>
</li>
<li><p>Then, follows the process of building the ROS(1) packages side. 
For that, one requires to source the environments so when the <code>ros1_bridge</code> is built with support for any messages that are on PATH and have an associated mapping between ROS1 and ROS2:</p>
<pre><code class="lang-sh"><span class="hljs-built_in">source</span> /opt/ros/melodic/setup.bash
<span class="hljs-built_in">source</span> /opt/ros/bouncy/setup.bash
</code></pre>
</li>
<li><p>Build the <code>px4_ros_com</code> package on the ROS end:</p>
<pre><code class="lang-sh"><span class="hljs-built_in">cd</span> ~/px4_ros_com_ros1 &amp;&amp; colcon build --symlink-install --event-handlers console_direct+
</code></pre>
</li>
<li><p>Then source the workspaces:</p>
<pre><code class="lang-sh"><span class="hljs-built_in">source</span> ~/px4_ros_com_ros1/install/setup.bash
<span class="hljs-built_in">source</span> ~/px4_ros_com_ros2/install/setup.bash
</code></pre>
</li>
<li><p>Finally, build the <code>ros1_bridge</code>. 
Note that the build process may consume a lot of memory resources.
On a resource limited machine, reduce the number of jobs being processed in parallel (e.g. set environment variable <code>MAKEFLAGS=-j1</code>). 
For more details on the build process, see the build instructions on the <a href="https://github.com/ros2/ros1_bridge" target="_blank">ros1_bridge</a> package page.</p>
<pre><code class="lang-sh"><span class="hljs-built_in">cd</span> ~/px4_ros_com_ros2 &amp;&amp; colcon build --symlink-install --packages-select ros1_bridge --cmake-force-configure --event-handlers console_direct+
</code></pre>
</li>
</ol>
<h2 id="creating-a-fast-rtps-listener-application">Creating a Fast RTPS Listener application</h2>
<p>Once the <em>Client</em> (on the flight controller) and the <em>Agent</em> (on an offboard computer) are running and connected, <em>Fast RTPS</em> applications can publish and subscribe to uORB topics on PX4 using RTPS.</p>
<p>This example shows how to create a <em>Fast RTPS</em> &quot;listener&quot; application that subscribes to the <code>sensor_combined</code> topic and prints out updates (from PX4). 
A connected RTPS application can run on any computer on the same network as the <em>Agent</em>. 
For this example the <em>Agent</em> and <em>Listener application</em> will be on the same computer.</p>
<p>The <em>fastrtpsgen</em> script can be used to generate a simple RTPS application from an IDL message file.</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> RTPS messages are defined in IDL files and compiled to C++ using <em>fastrtpsgen</em>. 
  As part of building the bridge code, IDL files are generated for the uORB message files that may be sent/received (see <strong>build/BUILDPLATFORM/src/modules/micrortps_bridge/micrortps_agent/idl/*.idl</strong>). 
  These IDL files are needed when you create a <em>Fast RTPS</em> application to communicate with PX4.</p>
</blockquote>
<p>Enter the following commands to create the application:</p>
<pre><code class="lang-sh"><span class="hljs-built_in">cd</span> /path/to/PX4/Firmware/src/modules/micrortps_bridge
mkdir micrortps_listener
<span class="hljs-built_in">cd</span> micrortps_listener
fastrtpsgen -example x64Linux2.6gcc ../micrortps_agent/idl/sensor_combined_.idl
</code></pre>
<p>This creates a basic subscriber and publisher, and a main-application to run them. 
To print out the data from the <code>sensor_combined</code> topic, modify the <code>onNewDataMessage()</code> method in <strong>sensor_combined_Subscriber.cxx</strong>:</p>
<pre><code class="lang-c++"><span class="hljs-keyword">void</span> sensor_combined_Subscriber::SubListener::onNewDataMessage(Subscriber* sub)
{
    <span class="hljs-comment">// Take data</span>
    sensor_combined_ st;

    <span class="hljs-keyword">if</span>(sub-&gt;takeNextData(&amp;st, &amp;m_info))
    {
        <span class="hljs-keyword">if</span>(m_info.sampleKind == ALIVE)
        {
            <span class="hljs-comment">// Print your structure data here.</span>
            ++n_msg;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;\n\n\n\n\n\n\n\n\n\n&quot;</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Sample received, count=&quot;</span> &lt;&lt; n_msg &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;=============================&quot;</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;gyro_rad: &quot;</span> &lt;&lt; st.gyro_rad().at(<span class="hljs-number">0</span>);
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; st.gyro_rad().at(<span class="hljs-number">1</span>);
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; st.gyro_rad().at(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;gyro_integral_dt: &quot;</span> &lt;&lt; st.gyro_integral_dt() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;accelerometer_timestamp_relative: &quot;</span> &lt;&lt; st.accelerometer_timestamp_relative() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;accelerometer_m_s2: &quot;</span> &lt;&lt; st.accelerometer_m_s2().at(<span class="hljs-number">0</span>);
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; st.accelerometer_m_s2().at(<span class="hljs-number">1</span>);
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; st.accelerometer_m_s2().at(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;accelerometer_integral_dt: &quot;</span> &lt;&lt; st.accelerometer_integral_dt() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;magnetometer_timestamp_relative: &quot;</span> &lt;&lt; st.magnetometer_timestamp_relative() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;magnetometer_ga: &quot;</span> &lt;&lt; st.magnetometer_ga().at(<span class="hljs-number">0</span>);
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; st.magnetometer_ga().at(<span class="hljs-number">1</span>);
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; st.magnetometer_ga().at(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;baro_timestamp_relative: &quot;</span> &lt;&lt; st.baro_timestamp_relative() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;baro_alt_meter: &quot;</span> &lt;&lt; st.baro_alt_meter() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;baro_temp_celcius: &quot;</span> &lt;&lt; st.baro_temp_celcius() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;

        }
    }
}
</code></pre>
<p>To build and run the application on Linux:</p>
<pre><code class="lang-sh">make <span class="hljs-_">-f</span> makefile_x64Linux2.6gcc
bin/*/sensor_combined_PublisherSubscriber subscriber
</code></pre>
<p>Now you should see the sensor information being printed out:</p>
<pre><code class="lang-sh">Sample received, count=10119
Received sensor_combined data
=============================
gyro_rad: -0.0103228, 0.0140477, 0.000319406
gyro_integral_dt: 0.004
accelerometer_timestamp_relative: 0
accelerometer_m_s2: -2.82708, -6.34799, -7.41101
accelerometer_integral_dt: 0.004
magnetometer_timestamp_relative: -10210
magnetometer_ga: 0.60171, 0.0405879, -0.040995
baro_timestamp_relative: -17469
baro_alt_meter: 368.647
baro_temp_celcius: 43.93
</code></pre>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> If the <em>Listener application</em> does not print anything, make sure the <em>Client</em> is running.</p>
</blockquote>
<h2 id="creating-a-ros2-listener">Creating a ROS2 listener</h2>
<p>With the <code>px4_ros_com</code> built successfully, one can now take advantage of the generated <em>micro-RTPS</em> agent app and also from the generated sources and headers of the ROS2 msgs, which represent a one-to-one matching with the uORB counterparts.</p>
<p>To create a listener node on ROS2, lets take as an example the <code>sensor_combined_listener.cpp</code> node under <code>px4_ros_com/src/listeners</code>:</p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;rclcpp/rclcpp.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;px4_ros_com/msg/sensor_combined.hpp&gt;</span></span>
</code></pre>
<p>The above brings to use the required C++ libraries to interface with the ROS2 middleware. It also includes the required message header file.</p>
<pre><code class="lang-c++"><span class="hljs-comment">/**
 * @brief Sensor Combined uORB topic data callback
 */</span>
<span class="hljs-keyword">class</span> SensorCombinedListener : <span class="hljs-keyword">public</span> rclcpp::Node
{
</code></pre>
<p>The above creates a <code>SensorCombinedListener</code> class that subclasses the generic <code>rclcpp::Node</code> base class.</p>
<pre><code class="lang-c++">public:
    explicit SensorCombinedListener() : Node(&quot;sensor_combined_listener&quot;) {
        auto callback =
        [this](const px4_ros_com::msg::SensorCombined::SharedPtr msg)-&gt;void
        {
            std::cout &lt;&lt; &quot;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;;
            std::cout &lt;&lt; &quot;RECEIVED DATA ON SENSOR COMBINED&quot; &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;================================&quot; &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;gyro_rad[0]: &quot; &lt;&lt; msg-&gt;gyro_rad[0] &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;gyro_rad[1]: &quot; &lt;&lt; msg-&gt;gyro_rad[1] &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;gyro_rad[2]: &quot; &lt;&lt; msg-&gt;gyro_rad[2] &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;gyro_integral_dt: &quot; &lt;&lt; msg-&gt;gyro_integral_dt &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;accelerometer_timestamp_relative: &quot; &lt;&lt; msg-&gt;accelerometer_timestamp_relative &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;accelerometer_m_s2[0]: &quot; &lt;&lt; msg-&gt;accelerometer_m_s2[0] &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;accelerometer_m_s2[1]: &quot; &lt;&lt; msg-&gt;accelerometer_m_s2[1] &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;accelerometer_m_s2[2]: &quot; &lt;&lt; msg-&gt;accelerometer_m_s2[2] &lt;&lt; std::endl;
            std::cout &lt;&lt; &quot;accelerometer_integral_dt: &quot; &lt;&lt; msg-&gt;accelerometer_integral_dt &lt;&lt; std::endl;
        };
</code></pre>
<p>This creates a callback function for when the <code>sensor_combined</code> messages are received. 
It outputs the content of the message fields each time the message is received.</p>
<pre><code class="lang-c++">        subscription_ = <span class="hljs-keyword">this</span>-&gt;create_subscription&lt;px4_ros_com::msg::SensorCombined&gt;(<span class="hljs-string">&quot;SensorCombined_topic&quot;</span>, callback);
    }

<span class="hljs-keyword">private</span>:
    rclcpp::Subscription&lt;px4_ros_com::msg::SensorCombined&gt;::SharedPtr subscription_;
};
</code></pre>
<p>The above create a subscription to the <code>sensor_combined_topic</code> which can be matched with one or more compatible ROS publishers.</p>
<pre><code class="lang-c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Starting sensor_combined listener node...&quot;</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>, _IONBF, BUFSIZ);
    rclcpp::init(argc, argv);
    rclcpp::spin(<span class="hljs-built_in">std</span>::make_shared&lt;SensorCombinedListener&gt;());

    rclcpp::shutdown();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>The instantiation of the <code>SensorCombinedListener</code> class as a ROS node is done on the <code>main</code> function.</p>
<h2 id="creating-a-ros2-advertiser">Creating a ROS2 advertiser</h2>
<p>A ROS2 advertiser node publishes data into the DDS/RTPS network (and hence to PX4).</p>
<p>Taking as an example the <code>debug_vect_advertiser.cpp</code> under <code>px4_ros_com/src/listeners</code>:</p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;chrono&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;rclcpp/rclcpp.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;px4_ros_com/msg/debug_vect.hpp&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>::chrono_literals;
</code></pre>
<p>Bring in the required headers, including the <code>debug_vect</code> msg header.</p>
<pre><code class="lang-c++"><span class="hljs-keyword">class</span> DebugVectAdvertiser : <span class="hljs-keyword">public</span> rclcpp::Node
{
</code></pre>
<p>The above creates a <code>DebugVectAdvertiser</code> class that subclasses the generic <code>rclcpp::Node</code> base class.</p>
<pre><code class="lang-c++"><span class="hljs-keyword">public</span>:
    DebugVectAdvertiser() : Node(<span class="hljs-string">&quot;debug_vect_advertiser&quot;</span>) {
        publisher_ = <span class="hljs-keyword">this</span>-&gt;create_publisher&lt;px4_ros_com::msg::DebugVect&gt;(<span class="hljs-string">&quot;DebugVect_topic&quot;</span>);
        <span class="hljs-keyword">auto</span> timer_callback =
        [<span class="hljs-keyword">this</span>]()-&gt;<span class="hljs-keyword">void</span> {
            <span class="hljs-keyword">auto</span> debug_vect = px4_ros_com::msg::DebugVect();
            debug_vect.timestamp = <span class="hljs-keyword">this</span>-&gt;now().nanoseconds() * <span class="hljs-number">1E-3</span>;
            debug_vect.x = <span class="hljs-number">1.0</span>;
            debug_vect.y = <span class="hljs-number">2.0</span>;
            debug_vect.z = <span class="hljs-number">3.0</span>;
            RCLCPP_INFO(<span class="hljs-keyword">this</span>-&gt;get_logger(), <span class="hljs-string">&quot;Publishing debug_vect: time: %f x:%f y:%f z:%f&quot;</span>,
                                debug_vect.timestamp, debug_vect.x, debug_vect.y, debug_vect.z)
            <span class="hljs-keyword">this</span>-&gt;publisher_-&gt;publish(debug_vect);
        };
        timer_ = <span class="hljs-keyword">this</span>-&gt;create_wall_timer(<span class="hljs-number">500</span>ms, timer_callback);
    }

<span class="hljs-keyword">private</span>:
    rclcpp::TimerBase::SharedPtr timer_;
    rclcpp::Publisher&lt;px4_ros_com::msg::DebugVect&gt;::SharedPtr publisher_;
};
</code></pre>
<p>This creates a function for when messages are to be sent. 
The messages are sent based on a timed callback, which sends two messages per second based on a timer.</p>
<pre><code class="lang-c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Starting debug_vect advertiser node...&quot;</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>, _IONBF, BUFSIZ);
    rclcpp::init(argc, argv);
    rclcpp::spin(<span class="hljs-built_in">std</span>::make_shared&lt;DebugVectAdvertiser&gt;());

    rclcpp::shutdown();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>The instantiation of the <code>DebugVectAdvertiser</code> class as a ROS node is done on the <code>main</code> function.</p>
<h2 id="creating-a-ros-listener">Creating a ROS listener</h2>
<p>The creation of ROS nodes is a well known and documented process. 
An example of a ROS listener for <code>sensor_combined</code> messages can be found in the <code>ros1</code> branch repo, under <code>px4_ros_com/src/listeners</code>.</p>
<h2 id="examplestests-of-ros-independent-apps">Examples/tests of ROS-independent apps</h2>
<p>The following examples provide additional real-world demonstrations of how to use the features described in this topic.</p>
<ul>
<li><a href="micrortps_throughput_test.html">Throughput test</a>: A simple test to measure the throughput of the bridge.</li>
</ul>
<h2 id="testing-the-px4-fastrpts-bridge-with-ros2-and-ros">Testing the PX4-FastRPTS bridge with ROS2 and ROS</h2>
<p>To quickly test the package (using PX4 SITL with Gazebo):</p>
<ol>
<li><p>Start the PX4 SITL with Gazebo using:</p>
<pre><code class="lang-sh">make px4_sitl_rtps gazebo`
</code></pre>
</li>
<li><p>On one terminal, source the ROS2 environment and workspace and launch the <code>ros1_bridge</code> (this allows ROS2 and ROS nodes to communicate with each other). 
Also set the <code>ROS_MASTER_URI</code> where the <code>roscore</code> is/will be running:</p>
<pre><code class="lang-sh">$ <span class="hljs-built_in">source</span> /opt/ros/ardent/setup.bash
$ <span class="hljs-built_in">source</span> ~/px4_ros_com_ros2/install/setup.bash
$ <span class="hljs-built_in">export</span> ROS_MASTER_URI=http://localhost:11311
$ ros2 run ros1_bridge dynamic_bridge
</code></pre>
</li>
<li><p>On another terminal, source the ROS workspace and launch the <code>sensor_combined</code> listener node. 
Since you are launching through <code>roslaunch</code>, this will also automatically start the <code>roscore</code>:</p>
<pre><code class="lang-sh">$ <span class="hljs-built_in">source</span> ~/px4_ros_com_ros1/install/setup.bash
$ roslaunch px4_ros_com sensor_combined_listener.launch
</code></pre>
</li>
<li><p>On a terminal, source the ROS2 workspace and then start the <code>micrortps_agent</code> daemon with UDP as the transport protocol:</p>
<pre><code class="lang-sh">$ <span class="hljs-built_in">source</span> ~/px4_ros_com_ros2/install/setup.bash
$ micrortps_agent -t UDP
</code></pre>
</li>
<li><p>On the <a href="../debug/system_console.html">NuttShell/System Console</a>, start the <code>micrortps_client</code> daemon also in UDP:</p>
<pre><code class="lang-sh">&gt; micrortps_client start -t UDP
</code></pre>
<p>Now you will be able to see the data being printed on the terminal/console where you launched the ROS listener:</p>
<pre><code class="lang-sh">RECEIVED DATA FROM SENSOR COMBINED
================================
gyro_rad[0]: 0.00341645
gyro_rad[1]: 0.00626475
gyro_rad[2]: -0.000515705
gyro_integral_dt: 4739
accelerometer_timestamp_relative: 0
accelerometer_m_s2[0]: -0.273381
accelerometer_m_s2[1]: 0.0949186
accelerometer_m_s2[2]: -9.76044
accelerometer_integral_dt: 4739

Publishing back...
</code></pre>
<p>You can also verify the rate of the message using <code>rostopic hz</code>. 
For the case of <code>sensor_combined</code>:</p>
<pre><code class="lang-sh">average rate: 248.187
    min: 0.000s max: 0.012s std dev: 0.00147s window: 2724
average rate: 248.006
    min: 0.000s max: 0.012s std dev: 0.00147s window: 2972
average rate: 247.330
    min: 0.000s max: 0.012s std dev: 0.00148s window: 3212
average rate: 247.497
    min: 0.000s max: 0.012s std dev: 0.00149s window: 3464
average rate: 247.458
    min: 0.000s max: 0.012s std dev: 0.00149s window: 3712
average rate: 247.485
    min: 0.000s max: 0.012s std dev: 0.00148s window: 3960
</code></pre>
</li>
<li><p>You can also test the <code>sensor_combined</code> ROS2 listener by typing in a terminal:</p>
<pre><code class="lang-sh">$ <span class="hljs-built_in">source</span> ~/px4_ros_com_ros2/install/setup.bash
$ sensor_combined_listener <span class="hljs-comment"># or ros2 run px4_ros_com sensor_combined_listener</span>
</code></pre>
</li>
</ol>
<p>And it should also get data being printed to the console output.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="client-reports-that-selected-uart-port-is-busy">Client reports that selected UART port is busy</h3>
<p>If the selected UART port is busy, it&apos;s possible that the MAVLink application is already being used. If both MAVLink and RTPS connections are required you will have to either move the connection to use another port or configure the port so that it can be shared. <!-- https://github.com/PX4/Devguide/issues/233 --></p>
<blockquote class="clearfix alert alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong>
<p> A quick/temporary fix to allow bridge testing during development is to stop MAVLink from <em>NuttShell</em>:</p>
<pre><code class="lang-sh">  mavlink stop-all
</code></pre>
</blockquote>
<h3 id="agent-not-builtfastrtpsgen-is-not-found">Agent not built/fastrtpsgen is not found</h3>
<p>The <em>Agent</em> code is generated using a <em>Fast RTPS</em> tool called <em>fastrtpsgen</em>.</p>
<p>If you haven&apos;t installed Fast RTPS in the default path then you must specify its installation directory by setting the <code>FASTRTPSGEN_DIR</code> environment variable before executing <em>make</em>.</p>
<p>On Linux/Mac this is done as shown below:</p>
<pre><code class="lang-sh"><span class="hljs-built_in">export</span> FASTRTPSGEN_DIR=/path/to/fastrtps/install/folder/bin
</code></pre>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-2x fa-edit"></strong>
<p> This should not be a problem if <a href="../setup/fast-rtps-installation.html">Fast RTPS is installed in the default location</a>.</p>
</blockquote>
<h3 id="enable-uart-on-an-obc-onboard-computer">Enable UART on an OBC (onboard computer)</h3>
<p>For UART transport on a Raspberry Pi or any other OBC you will have to enable the serial port:</p>
<ol>
<li><p>Make sure the <code>userid</code> (default is pi on a Raspberry Pi) is a member of the <code>dialout</code> group:</p>
<pre><code class="lang-sh">groups pi
sudo usermod <span class="hljs-_">-a</span> -G dialout pi
</code></pre>
</li>
<li><p>For the Raspberry Pi in particular, you need to stop the GPIO serial console that is using the port:</p>
<pre><code class="lang-sh">sudo raspi-config
</code></pre>
<p>In the menu showed go to <strong>Interfacing options &gt; Serial</strong>. 
Select <strong>NO</strong> for <em>Would you like a login shell to be accessible over serial?</em>. Valid and reboot.</p>
</li>
<li><p>Check UART in kernel:</p>
<pre><code class="lang-sh">sudo vi /boot/config.txt
</code></pre>
<p>And make sure that the <code>enable_uart</code> value is set to 1:</p>
<pre><code class="lang-txt"> enable_uart=1
</code></pre>
</li>
</ol>
<h2 id="additional-information">Additional information</h2>
<ul>
<li><a href="../setup/fast-rtps-installation.html">Fast RTPS Installation</a></li>
<li><a href="micrortps_manual_code_generation.html">Manually Generate Client and Agent Code</a></li>
<li><a href="https://github.com/ros2/ros2/wiki/DDS-and-ROS-middleware-implementations" target="_blank">DDS and ROS middleware implementations</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="mavlink.html" class="navigation navigation-prev " aria-label="Previous page: MAVLink Messaging">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="micrortps_throughput_test.html" class="navigation navigation-next " aria-label="Next page: Throughput Test">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"RTPS/ROS2 Interface","level":"1.6.4","depth":2,"next":{"title":"Throughput Test","level":"1.6.4.1","depth":3,"path":"middleware/micrortps_throughput_test.md","ref":"middleware/micrortps_throughput_test.md","articles":[]},"previous":{"title":"MAVLink Messaging","level":"1.6.3","depth":2,"path":"middleware/mavlink.md","ref":"middleware/mavlink.md","articles":[]},"dir":"ltr"},"config":{"plugins":["youtube","richquotes","collapsible-menu","-anchors","page-toc-button","ga","language-picker","custom-favicon","bulk-redirect@git+https://github.com/Dronecode/gitbook-plugin-bulk-redirect.git","toolbar@git+https://github.com/hamishwillee/gitbook-plugin-toolbar.git","validate-links","mathjax@git+https://github.com/Dronecode/plugin-mathjax.git#update_cdn","mermaid","-stub-out-blocks@git+https://github.com/hamishwillee/gitbook-plugin-stub-out-blocks.git","theme-dronecode@git+https://github.com/dronecode/theme-dronecode.git"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"theme-dronecode":{"logo":{"logo_large":"gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_full.png","logo_small":"gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_small.png","url":"https://www.dronecode.org/"}},"validate-links":{"defaultScheme":"https","local":"warn","remote":"disabled"},"collapsible-menu":{},"language-picker":{"grid-columns":3},"youtube":{},"search":{},"mermaid":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"language-redirect":{"baseurl":"https://dev.px4.io/"},"fontsettings":{"theme":"white","family":"sans","size":2},"richquotes":{"tip":{"alert":"success","picto":"fa-thumbs-o-up"}},"highlight":{},"favicon":"favicon.ico","page-toc-button":{},"bulk-redirect":{"basepath":"/","redirectsFile":"redirects.json"},"custom-favicon":{},"mathjax":{"forceSVG":false,"version":"2.7.1"},"ga":{"configuration":"auto","token":"UA-33658859-3"},"toolbar":{"buttons":[{"label":"Bug tracker","icon":"fa fa-bug","position":"left","url":"https://github.com/PX4/Devguide/issues/new?title=Doc+Bug:+{{title}}&body=DESCRIBE+PROBLEM+WITH+DOCS+HERE%0A%0ABug+Page:+[{{title}}]({{url}})"},{"label":"GitHub","icon":"fa fa-github","url":"https://github.com/PX4/Devguide"},{"label":"Edit page on github","icon":"fa fa-pencil-square-o","position":"left","url":"https://github.com/PX4/Devguide/edit/master/{{filepath_lang}}"}]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"logo":"./assets/site/logo_pro_small.png"},"title":"PX4 Developer Guide","language":"en","gitbook":"*"},"file":{"path":"middleware/micrortps.md","mtime":"2018-11-28T01:04:24.394Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-11-28T01:05:45.512Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

    

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-toolbar/buttons.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

