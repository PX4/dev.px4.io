
<!DOCTYPE HTML>
<html lang="kr" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>ecl EKF · PX4 Developer Guide</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-dronecode/theme_styles.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="pre_flight_checks.html" />
    
    
    <link rel="prev" href="../qgc/video_streaming_wifi_broadcast.html" />
    

    </head>
    <body>
        
    
    <!-- ##HW Add dronecode menu -->
    <div id="common_dronecode_menu">

      <div class="common_menu_logo large_version">
        <a href="https://www.dronecode.org/">
          <img src="../../gitbook/gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_full.png" alt="Dronecode logo (large)" />
        </a>
      </div>
      <div class="common_menu_logo small_version">
        <a href="https://www.dronecode.org/">
          <img src="../../gitbook/gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_small.png" alt="Dronecode logo (small)" />
        </a>
      </div>
      
      <div class="common_menu_options">
        
            <div class="common_dronecode_menu_item"><a href="http://px4.io/">PX4</a></div>
            <div class="common_dronecode_menu_item large_version"><a href="http://qgroundcontrol.com/">QGroundControl</a></div>
            <div class="common_dronecode_menu_item small_version"><a href="http://qgroundcontrol.com/">QGC</a></div>
            <div class="common_dronecode_menu_item"><a href="https://www.dronecode.org/sdk/">SDK</a></div>
            <div class="common_dronecode_menu_item"><a href="https://mavlink.io/en/">MAVLink</a></div>
            <div class="common_dronecode_menu_item large_version"><a href="https://www.dronecode.org/documentation/">Documentation</a></div>
            <div class="common_dronecode_menu_item small_version"><a href="https://www.dronecode.org/documentation/">Docs</a></div>
            <div class="common_dronecode_menu_item large_version"><a href="http://discuss.px4.io/">Support</a></div>
            <div class="common_dronecode_menu_item small_version"><a href="http://discuss.px4.io/">Help</a></div>
        
      </div>
    </div>
    
<!-- ##HW END Add dronecode menu -->
    
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    소개
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../setup/getting_started.html">
            
                <a href="../setup/getting_started.html">
            
                    
                    시작하기
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../setup/config_initial.html">
            
                <a href="../setup/config_initial.html">
            
                    
                    초기 설정
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../setup/dev_env.html">
            
                <a href="../setup/dev_env.html">
            
                    
                    툴체인 설치
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../setup/dev_env_mac.html">
            
                <a href="../setup/dev_env_mac.html">
            
                    
                    Mac OS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../setup/dev_env_linux.html">
            
                <a href="../setup/dev_env_linux.html">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.2.1" data-path="../setup/dev_env_linux_ubuntu.html">
            
                <a href="../setup/dev_env_linux_ubuntu.html">
            
                    
                    Ubuntu/Debian Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2.2" data-path="../setup/dev_env_linux_boutique.html">
            
                <a href="../setup/dev_env_linux_boutique.html">
            
                    
                    Arch/CentOS Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2.3" data-path="../setup/dev_env_advanced_linux.html">
            
                <a href="../setup/dev_env_advanced_linux.html">
            
                    
                    고급 Linux
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../setup/dev_env_windows.html">
            
                <a href="../setup/dev_env_windows.html">
            
                    
                    Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../setup/fast-rtps-installation.html">
            
                <a href="../setup/fast-rtps-installation.html">
            
                    
                    Fast RTPS 설치
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../setup/building_px4.html">
            
                <a href="../setup/building_px4.html">
            
                    
                    코드 빌드하기
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../setup/config_advanced.html">
            
                <a href="../setup/config_advanced.html">
            
                    
                    고급 설정
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../contribute/">
            
                <a href="../contribute/">
            
                    
                    기여하기
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../contribute/git_examples.html">
            
                <a href="../contribute/git_examples.html">
            
                    
                    GIT 예제
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../contribute/docs.html">
            
                <a href="../contribute/docs.html">
            
                    
                    Documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../contribute/licenses.html">
            
                <a href="../contribute/licenses.html">
            
                    
                    라이센스
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../concept/">
            
                <a href="../concept/">
            
                    
                    개념
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../concept/flight_modes.html">
            
                <a href="../concept/flight_modes.html">
            
                    
                    비행 모드
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../concept/architecture.html">
            
                <a href="../concept/architecture.html">
            
                    
                    아키텍쳐 개요
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../concept/flight_stack.html">
            
                <a href="../concept/flight_stack.html">
            
                    
                    비행 스택
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../concept/middleware.html">
            
                <a href="../concept/middleware.html">
            
                    
                    미들웨어
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../concept/mixing.html">
            
                <a href="../concept/mixing.html">
            
                    
                    미싱과 액츄레이터
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../concept/pwm_limit.html">
            
                <a href="../concept/pwm_limit.html">
            
                    
                    PWM limit 상태 머신
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../simulation/">
            
                <a href="../simulation/">
            
                    
                    시뮬레이션
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../simulation/jmavsim.html">
            
                <a href="../simulation/jmavsim.html">
            
                    
                    jMAVSim 시뮬레이션
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../simulation/gazebo.html">
            
                <a href="../simulation/gazebo.html">
            
                    
                    Gazebo 시뮬레이션
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../simulation/hitl.html">
            
                <a href="../simulation/hitl.html">
            
                    
                    HITL 시뮬레이션
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../simulation/ros_interface.html">
            
                <a href="../simulation/ros_interface.html">
            
                    
                    ROS 인터페이스
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../simulation/airsim.html">
            
                <a href="../simulation/airsim.html">
            
                    
                    AirSim 시뮬레이션
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../simulation/multi-vehicle-simulation.html">
            
                <a href="../simulation/multi-vehicle-simulation.html">
            
                    
                    Multi-Vehicle 시뮬레이션
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../hardware/">
            
                <a href="../hardware/">
            
                    
                    Hardware
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../flight_controller/">
            
                <a href="../flight_controller/">
            
                    
                    Autopilot 하드웨어
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" >
            
                <a target="_blank" href="https://dev.px4.io/en/hardware/porting_guide.html">
            
                    
                    Porting Guide
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../airframes/">
            
                <a href="../airframes/">
            
                    
                    Airframes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../airframes/architecture.html">
            
                <a href="../airframes/architecture.html">
            
                    
                    통합 코드베이스
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../airframes/airframe_reference.html">
            
                <a href="../airframes/airframe_reference.html">
            
                    
                    Airframes 레퍼런스
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="../airframes/adding_a_new_frame.html">
            
                <a href="../airframes/adding_a_new_frame.html">
            
                    
                    새로운 Airframe 추가
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../data_links/">
            
                <a href="../data_links/">
            
                    
                    Data Links
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../data_links/sik_radio.html">
            
                <a href="../data_links/sik_radio.html">
            
                    
                    SiK Radio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../advanced/telemetry_wifi.html">
            
                <a href="../advanced/telemetry_wifi.html">
            
                    
                    텔레메트리 Wifi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3" data-path="telemetry.html">
            
                <a href="telemetry.html">
            
                    
                    텔레메트리
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../sensor_bus/">
            
                <a href="../sensor_bus/">
            
                    
                    센서와 액츄레이터 버스
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="../sensor_bus/i2c.html">
            
                <a href="../sensor_bus/i2c.html">
            
                    
                    I2C Bus
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1.1" data-path="../sensor/sf1xx_lidar_setup.html">
            
                <a href="../sensor/sf1xx_lidar_setup.html">
            
                    
                    SF1XX lidar
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4.2" data-path="../uavcan/">
            
                <a href="../uavcan/">
            
                    
                    UAVCAN Bus
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.2.1" data-path="../uavcan/bootloader_installation.html">
            
                <a href="../uavcan/bootloader_installation.html">
            
                    
                    UAVCAN 부트로더
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.2.2" data-path="../uavcan/node_firmware.html">
            
                <a href="../uavcan/node_firmware.html">
            
                    
                    UAVCAN 펌웨어 업그레이드
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.2.3" data-path="../uavcan/node_enumeration.html">
            
                <a href="../uavcan/node_enumeration.html">
            
                    
                    UAVCAN 설정
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.2.4" data-path="../uavcan/notes.html">
            
                <a href="../uavcan/notes.html">
            
                    
                    UAVCAN 정보
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4.3" data-path="../sensor_bus/uart.html">
            
                <a href="../sensor_bus/uart.html">
            
                    
                    UART
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.3.1" data-path="../sensor/uart_ulanding_radar.html">
            
                <a href="../sensor/uart_ulanding_radar.html">
            
                    
                    uLanding Radar
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../advanced/rtk_gps.html">
            
                <a href="../advanced/rtk_gps.html">
            
                    
                    RTK GPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="camera_trigger.html">
            
                <a href="camera_trigger.html">
            
                    
                    Camera Trigger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../advanced/gimbal_control.html">
            
                <a href="../advanced/gimbal_control.html">
            
                    
                    짐벌 (마운트) 제어 셋업
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../companion_computer/pixhawk_companion.html">
            
                <a href="../companion_computer/pixhawk_companion.html">
            
                    
                    컴패니온 컴퓨터
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../middleware/">
            
                <a href="../middleware/">
            
                    
                    미들웨어와 아키텍쳐
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../middleware/uorb.html">
            
                <a href="../middleware/uorb.html">
            
                    
                    uORB 메시징
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../middleware/mavlink.html">
            
                <a href="../middleware/mavlink.html">
            
                    
                    MAVLink 메시징
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../middleware/micrortps.html">
            
                <a href="../middleware/micrortps.html">
            
                    
                    RTPS/ROS2 인터페이스
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="../middleware/micrortps_throughput_test.html">
            
                <a href="../middleware/micrortps_throughput_test.html">
            
                    
                    Throughput 테스트
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="../middleware/micrortps_manual_code_generation.html">
            
                <a href="../middleware/micrortps_manual_code_generation.html">
            
                    
                    수동 Client/Agent 생성
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../advanced/architecture_daemon.html">
            
                <a href="../advanced/architecture_daemon.html">
            
                    
                    데몬
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../middleware/drivers.html">
            
                <a href="../middleware/drivers.html">
            
                    
                    Driver 프레임워크
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../middleware/modules_main.html">
            
                <a href="../middleware/modules_main.html">
            
                    
                    모듈 & 명령
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../middleware/modules_command.html">
            
                <a href="../middleware/modules_command.html">
            
                    
                    명령
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../middleware/modules_communication.html">
            
                <a href="../middleware/modules_communication.html">
            
                    
                    통신
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../middleware/modules_driver.html">
            
                <a href="../middleware/modules_driver.html">
            
                    
                    드라이버
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../middleware/modules_estimator.html">
            
                <a href="../middleware/modules_estimator.html">
            
                    
                    Estimators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../middleware/modules_system.html">
            
                <a href="../middleware/modules_system.html">
            
                    
                    시스템
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../robotics/">
            
                <a href="../robotics/">
            
                    
                    로보틱스
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../ros/offboard_control.html">
            
                <a href="../ros/offboard_control.html">
            
                    
                    Linux에서 Offboard 제어
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../ros/">
            
                <a href="../ros/">
            
                    
                    ROS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="../ros/raspberrypi_installation.html">
            
                <a href="../ros/raspberrypi_installation.html">
            
                    
                    RPi에 ROS 설치
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="../ros/mavros_installation.html">
            
                <a href="../ros/mavros_installation.html">
            
                    
                    MAVROS (MAVLink on ROS)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="../ros/mavros_offboard.html">
            
                <a href="../ros/mavros_offboard.html">
            
                    
                    MAVROS offboard 예제
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.4" data-path="../ros/external_position_estimation.html">
            
                <a href="../ros/external_position_estimation.html">
            
                    
                    외부 Position Estimation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.5" data-path="../simulation/gazebo_octomap.html">
            
                <a href="../simulation/gazebo_octomap.html">
            
                    
                    Gazebo Octomap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../robotics/dronekit.html">
            
                <a href="../robotics/dronekit.html">
            
                    
                    DroneKit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../debug/">
            
                <a href="../debug/">
            
                    
                    Debugging/Logging
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../debug/faq.html">
            
                <a href="../debug/faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../debug/system_console.html">
            
                <a href="../debug/system_console.html">
            
                    
                    시스템 콘솔
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../debug/gdb_debugging.html">
            
                <a href="../debug/gdb_debugging.html">
            
                    
                    Autopilot 디버깅
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../debug/sensor_uorb_topic_debugging.html">
            
                <a href="../debug/sensor_uorb_topic_debugging.html">
            
                    
                    Sensor/Topic 디버깅
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../debug/simulation_debugging.html">
            
                <a href="../debug/simulation_debugging.html">
            
                    
                    Simulation 디버깅
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../debug/system_wide_replay.html">
            
                <a href="../debug/system_wide_replay.html">
            
                    
                    시스템 수준 Replay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../debug/profiling.html">
            
                <a href="../debug/profiling.html">
            
                    
                    프로파일링
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../debug/debug_values.html">
            
                <a href="../debug/debug_values.html">
            
                    
                    디버거 값 보내기
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../log/logging.html">
            
                <a href="../log/logging.html">
            
                    
                    로깅
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../log/flight_log_analysis.html">
            
                <a href="../log/flight_log_analysis.html">
            
                    
                    비행 로그 분석
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../log/ulog_file_format.html">
            
                <a href="../log/ulog_file_format.html">
            
                    
                    ULog 파일 포맷
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="tutorials.html">
            
                <a href="tutorials.html">
            
                    
                    튜토리얼
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../qgc/">
            
                <a href="../qgc/">
            
                    
                    그라운드 컨트롤 스테이션
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="tutorial_hello_sky.html">
            
                <a href="tutorial_hello_sky.html">
            
                    
                    어플리케이션 작성하기
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../qgc/video_streaming.html">
            
                <a href="../qgc/video_streaming.html">
            
                    
                    QGC 비디오 스트리밍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../qgc/video_streaming_wifi_broadcast.html">
            
                <a href="../qgc/video_streaming_wifi_broadcast.html">
            
                    
                    장거리 비디오 스트리밍
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10.5" data-path="tuning_the_ecl_ekf.html">
            
                <a href="tuning_the_ecl_ekf.html">
            
                    
                    ecl EKF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="pre_flight_checks.html">
            
                <a href="pre_flight_checks.html">
            
                    
                    비행전 체크
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="land_detector.html">
            
                <a href="land_detector.html">
            
                    
                    착륙 감지기
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="motion-capture-vicon-optitrack.html">
            
                <a href="motion-capture-vicon-optitrack.html">
            
                    
                    모션 캡쳐 (VICON, Optitrack)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="linux_sbus.html">
            
                <a href="linux_sbus.html">
            
                    
                    리눅스 S.Bus 드라이버
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../advanced/">
            
                <a href="../advanced/">
            
                    
                    Advanced Topics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../advanced/system_startup.html">
            
                <a href="../advanced/system_startup.html">
            
                    
                    시스템 부트
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../advanced/parameters_and_configurations.html">
            
                <a href="../advanced/parameters_and_configurations.html">
            
                    
                    퍄라미터 & 설정
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../advanced/parameter_reference_korean.html">
            
                <a href="../advanced/parameter_reference_korean.html">
            
                    
                    파라미터 레퍼런스 (Korean)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../advanced/parameter_reference.html">
            
                <a href="../advanced/parameter_reference.html">
            
                    
                    파라미터 레퍼런스 (English)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../advanced/realsense_intel_driver.html">
            
                <a href="../advanced/realsense_intel_driver.html">
            
                    
                    Intel RealSense R200 드라이버 설치
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="../advanced/switching_state_estimators.html">
            
                <a href="../advanced/switching_state_estimators.html">
            
                    
                    State Estimators 스위칭
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="../advanced/out_of_tree_modules.html">
            
                <a href="../advanced/out_of_tree_modules.html">
            
                    
                    Out-of-tree 모듈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.8" data-path="../software_update/stm32_bootloader.html">
            
                <a href="../software_update/stm32_bootloader.html">
            
                    
                    STM32 부트로더
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../test_and_ci/">
            
                <a href="../test_and_ci/">
            
                    
                    테스팅과 CI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" >
            
                <a target="_blank" href="https://dev.px4.io/en/test_and_ci/unit_tests.html">
            
                    
                    Unit Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../test_and_ci/continous_integration.html">
            
                <a href="../test_and_ci/continous_integration.html">
            
                    
                    지속 통합
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../test_and_ci/jenkins_ci.html">
            
                <a href="../test_and_ci/jenkins_ci.html">
            
                    
                    Jenkins 지속 통합
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../test_and_ci/integration_testing.html">
            
                <a href="../test_and_ci/integration_testing.html">
            
                    
                    통합 테스팅
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../test_and_ci/docker.html">
            
                <a href="../test_and_ci/docker.html">
            
                    
                    Docker 컨테이너
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../test_and_ci/maintenance.html">
            
                <a href="../test_and_ci/maintenance.html">
            
                    
                    유지보수
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Dronecode 바로가기</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://docs.px4.io/en/">
            
                    
                    PX4 사용자 가이드
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <a target="_blank" href="https://docs.qgroundcontrol.com/en/">
            
                    
                    QGroundControl 사용자 가이드
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <a target="_blank" href="https://dev.qgroundcontrol.com/en/">
            
                    
                    QGroundControl 개발자 가이드
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <a target="_blank" href="https://mavlink.io/en/">
            
                    
                    MAVLink 개발자 가이드
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <a target="_blank" href="https://sdk.dronecode.org/en/">
            
                    
                    Dronecode SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" >
            
                <a target="_blank" href="https://camera-manager.dronecode.org/en/">
            
                    
                    Dronecode Camera Manager
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >ecl EKF</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="using-the-ecl-ekf">Using the ecl EKF</h1>
<p>This tutorial answers common questions about use of the ECL EKF algorithm.</p>
<h2 id="what-is-the-ecl-ekf">What is the ecl EKF?</h2>
<p>The ECL (Estimation and Control Library) uses an Extended Kalman Filter algorithm to process sensor measurements and provide an estimate of the following states:</p>
<ul>
<li>Quaternion defining the rotation from North, East, Down local earth frame to X,Y,Z body frame</li>
<li>Velocity at the IMU - North,East,Down (m/s)</li>
<li>Position at the IMU - North,East,Down (m)</li>
<li>IMU delta angle bias estimates - X,Y,Z (rad)</li>
<li>IMU delta velocity bias estimates - X,Y,Z(m/s)</li>
<li>Earth Magnetic field components - North,East,Down (gauss)</li>
<li>Vehicle body frame magnetic field bias - X,Y,Z (gauss)</li>
<li>Wind velocity - North,East (m/s)</li>
</ul>
<p>The EKF runs on a delayed &apos;fusion time horizon&apos; to allow for different time delays on each measurement relative to the IMU. Data for each sensor is FIFO buffered and retrieved from the buffer by the EKF to be used at the correct time. The delay compensation for each sensor is controlled by the EKF2_*_DELAY parameters.</p>
<p>A complementary filter is used to propagate the states forward from the &apos;fusion time horizon&apos; to current time using the buffered IMU data. The time constant for this filter is controlled by the EKF2_TAU_VEL and EKF2_TAU_POS parameters.</p>
<p>Note: The &apos;fusion time horizon&apos; delay and length of the buffers is determined by the largest of the EKF2_*_DELAY parameters. If a sensor is not being used, it is recommended to set its time delay to zero. Reducing the &apos;fusion time horizon&apos; delay reduces errors in the complementary filter used to propagate states forward to current time.</p>
<p>The position and velocity states are adjusted to account for the offset between the IMU and the body frame before they are output to the control loops. The position of the IMU relative to the body frame is set by the EKF2_IMU_POS_X,Y,Z parameters.</p>
<p>The EKF uses the IMU data for state prediction only. IMU data is not used as an observation in the EKF derivation. The algebraic equations for the covariance prediction, state update and covariance update were derived using the Matlab symbolic toolbox and can be found here: <a href="https://github.com/PX4/ecl/blob/master/matlab/scripts/Inertial Nav EKF/GenerateNavFilterEquations.m" target="_blank">Matlab Symbolic Derivation</a></p>
<h2 id="what-sensor-measurements-does-it-use">What sensor measurements does it use?</h2>
<p>The EKF has different modes of operation that allow for different combinations of sensor measurements. On start-up the filter checks for a minimum viable combination of sensors and after initial tilt, yaw and height alignment is completed, enters a mode that provides rotation, vertical velocity,  vertical position, IMU delta angle bias and IMU delta velocity bias estimates.</p>
<p>This mode requires IMU data, a source of yaw (magnetometer or external vision) and a source of height data. This minimum data set is required for all EKF modes of operation. Other sensor data can then be used to estimate additional states.</p>
<h3 id="imu">IMU</h3>
<ul>
<li>Three axis body fixed Inertial Measurement unit delta angle and delta velocity data at a minimum rate of 100Hz. Note: Coning corrections should be applied to the IMU delta angle data before it is used by the EKF.</li>
</ul>
<h3 id="magnetometer">Magnetometer</h3>
<p>Three axis body fixed magnetometer data (or external vision system pose data) at a minimum rate of 5Hz is required. Magnetometer data can be used in two ways:</p>
<ul>
<li>Magnetometer measurements are converted to a yaw angle using the tilt estimate and magnetic declination. This yaw angle is then used as an observation by the EKF. This method is less accurate and does not allow for learning of body frame field offsets, however it is more robust to magnetic anomalies and large start-up gyro biases. It is the default method used during start-up and on ground.</li>
<li>The  XYZ magnetometer readings are used as separate observations. This method is more accurate and allows body frame offsets to be learned, but assumes the earth magnetic field environment only changes slowly and performs less well when there are significant external magnetic anomalies. It is the default method when the vehicle is airborne and has climbed past 1.5 m altitude.</li>
</ul>
<p>The logic used to select the mode is set by the EKF2_MAG_TYPE parameter.</p>
<h3 id="height">Height</h3>
<p>A source of height data - either GPS, barometric pressure, range finder or external vision at a minimum rate of 5Hz is required. Note: The primary source of height data is controlled by the EKF2_HGT_MODE parameter.</p>
<p>If these measurements are not present, the EKF will not start. When these measurements have been detected, the EKF will initialise the states and complete the tilt and yaw alignment. When tilt and yaw alignment is complete, the EKF can then transition to other modes of operation  enabling use of additional sensor data:</p>
<h3 id="gps">GPS</h3>
<p>GPS measurements will be used for position and velocity if the following conditions are met:</p>
<ul>
<li>GPS use is enabled via setting of the EKF2_AID_MASK parameter.</li>
<li>GPS quality checks have passed. These checks are controlled by the EKF2_GPS_CHECK and EKF2_REQ_* parameters.</li>
<li>GPS height can be used directly by the EKF via setting of the EKF2_HGT_MODE parameter.</li>
</ul>
<h3 id="range-finder">Range Finder</h3>
<p>Range finder distance to ground is used a by a single state filter to estimate the vertical position of the terrain relative to the height datum.</p>
<p>If operating over a flat surface that can be used as a zero height datum, the range finder data can also be used directly by the EKF to estimate height by setting the EKF2_HGT_MODE parameter to 2.</p>
<h3 id="airspeed">Airspeed</h3>
<p>Equivalent Airspeed (EAS) data can be used to estimate wind velocity and reduce drift when GPS is lost by setting EKF2_ARSP_THR to a positive value. Airspeed data will be used when it exceeds the threshold set by a positive value for EKF2_ARSP_THR and the vehicle type is not rotary wing.</p>
<h3 id="synthetic-sideslip">Synthetic Sideslip</h3>
<p>Fixed wing platforms can take advantage of an assumed sideslip observation of zero to improve wind speed estimation and also enable wind speed estimation without an airspeed sensor. This is enabled by setting the EKF2_FUSE_BETA parameter to 1.</p>
<h3 id="drag-specific-forces">Drag Specific Forces</h3>
<p>Multi-rotor platforms can take advantage of the relationship between airspeed and drag force along the X and Y body axes to estimate North/East components of wind velocity. This is enabled by setting bit position 4 in the EKF2_AID_MASK parameter to true. The relationship between airspeed and specific force (IMU acceleration) along the X and Y body axes is controlled by the the EKF2_BCOEF_X and EKF2_BCOEF_Y parameters which set the ballistic coefficients for flight in the X and Y directions respectively.. The amount of specific force observation noise is set by the EKF2_DRAG_NOISE parameter.</p>
<h3 id="optical-flow">Optical Flow</h3>
<p>Optical flow data will be used if the following conditions are met:</p>
<ul>
<li>Valid range finder data is available.</li>
<li>Bit position 1 in the EKF2_AID_MASK parameter is true.</li>
<li>The quality metric returned by the flow sensor is greater than the minimum requirement set by the EKF2_OF_QMIN parameter</li>
</ul>
<h3 id="external-vision-system">External Vision System</h3>
<p>Position and Pose Measurements from an external vision system, eg Vicon, can be used:</p>
<ul>
<li>External vision system horizontal position data will be used if bit position 3 in the EKF2_AID_MASK parameter is true.</li>
<li>External vision system vertical position data will be used if the EKF2_HGT_MODE parameter is set to 3.</li>
<li>External vision system pose data will be used for yaw estimation if bit position 4 in the EKF2_AID_MASK parameter is true.</li>
</ul>
<h2 id="how-do-i-use-the-ecl-library-ekf">How do I use the &apos;ecl&apos; library EKF?</h2>
<p>Set the SYS_MC_EST_GROUP parameter to 2 to use the ecl EKF.</p>
<h2 id="what-are-the-advantages-and-disadvantages-of-the-ecl-ekf-over-other-estimators">What are the advantages and disadvantages of the ecl EKF over other estimators?</h2>
<p>Like all estimators, much of the performance comes from the tuning to match sensor characteristics. Tuning is a compromise between accuracy and robustness and although we have attempted to provide a tune that meets the needs of most users, there will be applications where tuning changes are required.</p>
<p>For this reason, no claims for accuracy relative to the legacy combination of attitude_estimator_q + local_position_estimator have been made and the best choice of estimator will depend on the application and tuning.</p>
<h3 id="disadvantages">Disadvantages</h3>
<ul>
<li>The ecl EKF is a complex algorithm that requires a good understanding of extended Kalman filter theory and its application to navigation problems to tune successfully. It is therefore more difficult for users that are not achieving good results to know what to change.</li>
<li>The ecl EKF uses more RAM and flash space</li>
<li>The ecl EKF uses more logging space.</li>
<li>The ecl EKF has had less flight time</li>
</ul>
<h3 id="advantages">Advantages</h3>
<ul>
<li>The ecl EKF is able to fuse data from sensors with different time delays and data rates in a mathematically consistent way which improves accuracy during dynamic manoeuvres once time delay parameters are set correctly.</li>
<li>The ecl EKF is capable of fusing a large range of different sensor types.</li>
<li>The ecl EKF detects and reports statistically significant inconsistencies in sensor data, assisting with diagnosis of sensor errors.</li>
<li>For fixed wing operation, the ecl EKF estimates wind speed with or without an airspeed sensor and is able to use the estimated wind in combination with airspeed measurements and sideslip assumptions to extend the dead-reckoning time available if GPS is lost in flight.</li>
<li>The ecl EKF estimates 3-axis accelerometer bias which improves accuracy for tailsitters and other vehicles that experience large attitude changes between flight phases.</li>
<li>The federated architecture (combined attitude and position/velocity estimation) means that attitude estimation benefits from all sensor measurements. This should provide the potential for improved attitude estimation if tuned correctly.</li>
</ul>
<h2 id="how-do-i-check-the-ekf-performance">How do I check the EKF performance?</h2>
<p>EKF outputs, states and status data are published to a number of uORB topics which are logged to the SD card during flight. The following guide assumes that data has been logged using the .ulog file format. To use the .ulog format, set the SYS_LOGGER parameter to 1.</p>
<p>The .ulog format data can be parsed in python by using the <a href="https://github.com/PX4/pyulog" target="_blank">PX4 pyulog library</a>.</p>
<p>Most of the EKF data is found in the <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a> and <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a> uORB messages that are logged to the .ulog file.</p>
<p>A python script that automatically generates analysis plots and metadata can be found <a href="https://github.com/PX4/Firmware/blob/master/Tools/ecl_ekf/process_logdata_ekf.py" target="_blank">here</a>. To use this script file, cd to the <code>Tools/ecl_ekf</code> directory and enter <code>python process_logdata_ekf.py &lt;log_file.ulg&gt;</code>. This saves performance metadata in a csv file named <code>&lt;log_file&gt;.mdat.csv</code> and plots in a pdf file named <code>&lt;log_file&gt;.pdf</code>.</p>
<p>Multiple log files in a directory can be analysed using the <a href="https://github.com/PX4/Firmware/blob/master/Tools/ecl_ekf/batch_process_logdata_ekf.py" target="_blank">batch_process_logdata_ekf.py</a> script. When this has been done, the performance metadata files can be processed to provide a statistical assessment of the estimator performance across the population of logs using the <a href="https://github.com/PX4/Firmware/blob/master/Tools/ecl_ekf/batch_process_metadata_ekf.py" target="_blank">batch_process_metadata_ekf.py</a> script.</p>
<h3 id="output-data">Output Data</h3>
<ul>
<li>Attitude output data is found in the <a href="https://github.com/PX4/Firmware/blob/master/msg/vehicle_attitude.msg" target="_blank">vehicle_attitude</a> message.</li>
<li>Local position output data is found in the <a href="https://github.com/PX4/Firmware/blob/master/msg/vehicle_local_position.msg" target="_blank">vehicle_local_position</a> message.</li>
<li>Global (WGS-84) output data is found in the <a href="https://github.com/PX4/Firmware/blob/master/msg/vehicle_global_position.msg" target="_blank">vehicle_global_position</a> message.</li>
<li>Wind velocity output data is found in the <a href="https://github.com/PX4/Firmware/blob/master/msg/wind_estimate.msg" target="_blank">wind_estimate</a> message.</li>
</ul>
<h3 id="states">States</h3>
<p>Refer to states[32] in <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>. The index map for states[32] is as follows:</p>
<ul>
<li>[0 ... 3] Quaternions</li>
<li>[4 ... 6] Velocity NED (m/s)</li>
<li>[7 ... 9] Position NED (m)</li>
<li>[10 ... 12] IMU delta angle bias XYZ (rad)</li>
<li>[13 ... 15] IMU delta velocity bias XYZ (m/s)</li>
<li>[16 ... 18] Earth magnetic field NED (gauss)</li>
<li>[19 ... 21] Body magnetic field XYZ (gauss)</li>
<li>[22 ... 23] Wind velocity NE (m/s)</li>
<li>[24 ... 32] Not Used</li>
</ul>
<h3 id="state-variances">State Variances</h3>
<p>Refer to covariances[28] in <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>. The index map for covariances[28] is as follows:</p>
<ul>
<li>[0 ... 3] Quaternions</li>
<li>[4 ... 6] Velocity NED (m/s)^2</li>
<li>[7 ... 9] Position NED (m^2)</li>
<li>[10 ... 12] IMU delta angle bias XYZ (rad^2)</li>
<li>[13 ... 15] IMU delta velocity bias XYZ (m/s)^2</li>
<li>[16 ... 18] Earth magnetic field NED (gauss^2)</li>
<li>[19 ... 21] Body magnetic field XYZ (gauss^2)</li>
<li>[22 ... 23] Wind velocity NE (m/s)^2</li>
<li>[24 ... 28] Not Used</li>
</ul>
<h3 id="observation-innovations">Observation Innovations</h3>
<ul>
<li>Magnetometer XYZ (gauss) : Refer to mag_innov[3] in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Yaw angle (rad) : Refer to heading_innov in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Velocity and position innovations : Refer to vel_pos_innov[6] in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>. The index map for vel_pos_innov[6] is as follows:<ul>
<li>[0 ... 2] Velocity NED (m/s)</li>
<li>[3 ... 5] Position NED (m)</li>
</ul>
</li>
<li>True Airspeed (m/s) : Refer to airspeed_innov in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Synthetic sideslip (rad) : Refer to beta_innov in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Optical flow XY (rad/sec) : Refer to flow_innov in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Height above ground (m) : Refer to hagl_innov in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
</ul>
<h3 id="observation-innovation-variances">Observation Innovation Variances</h3>
<ul>
<li>Magnetometer XYZ (gauss^2) : Refer to mag_innov_var[3] in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Yaw angle (rad^2) : Refer to heading_innov_var in the ekf2_innovations message.</li>
<li>Velocity and position innovations : Refer to vel_pos_innov_var[6] in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>. The index map for vel_pos_innov_var[6] is as follows:<ul>
<li>[0 ... 2] Velocity NED (m/s)^2</li>
<li>[3 ... 5] Position NED (m^2)</li>
</ul>
</li>
<li>True Airspeed (m/s)^2 : Refer to airspeed_innov_var in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Synthetic sideslip (rad^2) : Refer to beta_innov_var in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Optical flow XY (rad/sec)^2 : Refer to flow_innov_var in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
<li>Height above ground (m^2) : Refer to hagl_innov_var in <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.</li>
</ul>
<h3 id="output-complementary-filter">Output Complementary Filter</h3>
<p>The output complementary filter is used to propagate states forward from the fusion time horizon to current time. To check the magnitude of the angular, velocity and position tracking errors measured at the fusion time horizon, refer to output_tracking_error[3] in the ekf2_innovations message. The index map is as follows:</p>
<ul>
<li>[0] Angular tracking error magnitude (rad)</li>
<li>[1] Velocity tracking error magnitude (m/s). The velocity tracking time constant can be adjusted using the EKF2_TAU_VEL parameter. Reducing this parameter reduces steady state errors but increases the amount of observation noise on the NED velocity outputs.</li>
<li>[2] Position tracking error magnitude (m). The position tracking time constant can be adjusted using the EKF2_TAU_POS parameter. Reducing this parameter reduces steady state errors but increases the amount of observation noise on the NED position outputs.</li>
</ul>
<h3 id="ekf-errors">EKF Errors</h3>
<p>The EKF contains internal error checking for badly conditioned state and covariance updates. Refer to the filter_fault_flags in <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.</p>
<h3 id="observation-errors">Observation Errors</h3>
<p>There are two categories of observation faults:</p>
<ul>
<li>Loss of data. An example of this is a range finder failing to provide a return.</li>
<li>The innovation, which is the difference between the state prediction and sensor observation is excessive. An example of this is excessive vibration causing a large vertical position error, resulting in the barometer height measurement being rejected.</li>
</ul>
<p>Both of these can result in observation data being rejected for long enough to cause the EKF to attempt a reset of the states using the sensor observations. All observations have a statistical confidence checks applied to the innovations. The number of standard deviations for the check are controlled by the EKF2_*_GATE parameter for each observation type.</p>
<p>Test levels are  available in <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a> as follows:</p>
<ul>
<li>mag_test_ratio : ratio of the largest magnetometer innovation component to the innovation test limit</li>
<li>vel_test_ratio : ratio of the largest velocity innovation component to the innovation test limit</li>
<li>pos_test_ratio : ratio of the largest horizontal position innovation component to the innovation test limit</li>
<li>hgt_test_ratio : ratio of the vertical position innovation to the innovation test limit</li>
<li>tas_test_ratio : ratio of the true airspeed innovation to the innovation test limit</li>
<li>hagl_test_ratio : ratio of the height above ground innovation to the innovation test limit</li>
</ul>
<p>For a binary pass/fail summary for each sensor, refer to innovation_check_flags in <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.</p>
<h3 id="gps-quality-checks">GPS Quality Checks</h3>
<p>The EKF applies a number of GPS quality checks before commencing GPS aiding. These checks are controlled by the EKF2_GPS_CHECK and EKF2_REQ_* parameters. The pass/fail status for these checks is logged in the <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.gps_check_fail_flags message. This integer will be zero when all required GPS checks have passed. If the EKF is not commencing GPS alignment, check the value of the integer against the bitmask definition gps_check_fail_flags in <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.</p>
<h3 id="ekf-numerical-errors">EKF Numerical Errors</h3>
<p>The EKF uses single precision floating point operations for all of its computations and first order approximations for derivation of the covariance prediction and update equations in order to reduce processing requirements. This means that it is possible when re-tuning the EKF to encounter conditions where the covariance matrix operations become badly conditioned enough to cause divergence or significant errors in the state estimates.</p>
<p>To prevent this, every covariance and state update step contains the following error detection and correction steps:</p>
<ul>
<li>If the innovation variance is less than the observation variance (this requires a negative state variance which is impossible) or the covariance update will produce a negative variance for any of the states, then:<ul>
<li>The state and covariance update is skipped</li>
<li>The corresponding rows and columns in the covariance matrix are reset</li>
<li>The failure is recorded in the <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a> filter_fault_flags message</li>
</ul>
</li>
<li>State variances (diagonals in the covariance matrix) are constrained to be non-negative.</li>
<li>An upper limit is applied to state variances.</li>
<li>Symmetry is forced on the covariance matrix.</li>
</ul>
<p>After re-tuning the filter, particularly re-tuning that involve reducing the noise variables,  the value of estimator_status.gps_check_fail_flags should be checked to ensure that it remains zero.</p>
<h2 id="what-should-i-do-if-the-height-estimate-is-diverging">What should I do if the height estimate is diverging?</h2>
<p>The most common cause of EKF height diverging away from GPS and altimeter measurements during flight is clipping and/or aliasing of the IMU measurements caused by vibration. If this is occurring, then the following signs should be evident in the data</p>
<ul>
<li><a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.vel_pos_innov[3] and  <a href="https://github.com/PX4/Firmware/blob/master/msg/ekf2_innovations.msg" target="_blank">ekf2_innovations</a>.vel_pos_innov[5] will both have the same sign.</li>
<li><a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.hgt_test_ratio will be greater than 1.0</li>
</ul>
<p>The recommended first step is to  esnure that the autopilot is isolated from the airframe using an effective isolatoin mounting system. An isolaton mount has 6 degrees of freedom, and therefore 6 resonant frequencies. As a general rule, the 6 resonant frequencies of the autopilot on the isolation mount should be above 25Hz to avoid interaction with the autopilot dynamics and below the frequency of the motors.</p>
<p>An isolation mount can make vibration worse if the resonant frequncies coincide with motor or propeller blade passage frequencies.</p>
<p>The EKF can be made more resistant to vibration induced height divergence by making the following parameter changes:</p>
<ul>
<li>Double the value of the innovation gate for the primary height sensor. If using barometeric height this is EK2_EKF2_BARO_GATE.</li>
<li>Increase the value of EKF2_ACC_NOISE to 0.5 initially. If divergence is still occurring,   increase in further increments of 0.1 but do not go above 1.0</li>
</ul>
<p>Note that the effect of these changes will make the EKF more sensitive to errors in GPS vertical velocity and barometric pressure.</p>
<h2 id="what-should-i-do-if-the-position-estimate-is-diverging">What should I do if the position estimate is diverging?</h2>
<p>The most common causes of position divergence are:</p>
<ul>
<li>High vibration levels.<ul>
<li>Fix by improving mechanical isolation of the autopilot.</li>
<li>Increasing the value of EKF2_ACC_NOISE and EKF2_GYR_NOISE can help, but does make the EKF more vulnerable to GPS glitches.</li>
</ul>
</li>
<li>Large gyro bias offsets.<ul>
<li>Fix by re-calibrating the gyro. Check for excessive temperature sensitivity (&gt; 3 deg/sec bias change during warm-up from a cold start and replace the sensor if affected of insulate to to slow the rate of temeprature change.</li>
</ul>
</li>
<li>Bad yaw alignment<ul>
<li>Check the magntometer calibration and alignment.</li>
<li>Check the heading shown QGC is within within 15 deg truth</li>
</ul>
</li>
<li>Poor GPS accuracy<ul>
<li>Check for interference</li>
<li>Improve separation and shielding</li>
<li>Check flying location for GPS signal obstructions and reflectors (nearboy tall buildings)</li>
</ul>
</li>
<li>Loss of GPS</li>
</ul>
<p>Determining which of these is the primary cause requires a methodical approach to analysis of the EKF log data:</p>
<ul>
<li>Plot the velocty innovation test ratio - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.vel_test_ratio</li>
<li>Plot the horizontal position innovation test ratio - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.pos_test_ratio</li>
<li>Plot the height innovation test ratio - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.hgt_test_ratio</li>
<li>Plot the magnetoemrer innovation test ratio - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.mag_test_ratio</li>
<li>Plot the GPS receier reported speed accuracy - <a href="https://github.com/PX4/Firmware/blob/master/msg/vehicle_gps_position.msg" target="_blank">vehicle_gps_position</a>.s_variance_m_s</li>
<li>Plot the IMU delta angle state estimates - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.states[10], states[11] and states[12]</li>
<li>Plot the EKF internal high frequency vibration metrics:<ul>
<li>Delta angle coning vibration - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.vibe[0]</li>
<li>High frequency delta angle vibration - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.vibe[1]</li>
<li>High frequency delta velocity vibration - <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.vibe[2]</li>
</ul>
</li>
</ul>
<p>During normal operation, all the test ratios should remain below 0.5 with only occasional spikes above this as shown in the example below from a successful flight:<br><img src="../../assets/ecl/test_ratios_-_successful.png" alt="Position, Velocity, Height and Magnetometer Test Ratios"><br>The following plot shows the EKF vibration metrics for a multirotor with good isolation. The landing shock and the increased vibration during takeoff and landing can be seen. Insufficient data has been gathered with these metrics to provide specific advice on maximum thresholds.<br><img src="../../assets/ecl/vibration_metrics_-_successful.png" alt=""><br>The above vibration metrics are of limited value as the presence of vibration at a frequency close to the IMU sampling frequency (1 kHz for most boards) will cause  offsets to appear in the data that do not show up in the high frequency vibration metrics. The only way to detect aliasing errors is in their effect on inertial navigation accuracy and the rise in innovation levels.</p>
<p>In addition to generating large position and velocity test ratios of &gt; 1.0, the different error mechanisms affect the other test ratios in different ways:</p>
<h3 id="determination-of-excessive-vibration">Determination of Excessive Vibration</h3>
<p>High vibration levels normally affect vertical position and velocity innovations as well as the horizontal components. Magnetometer test levels are only affected to a small extent.</p>
<p>(insert example plots showing bad vibration here)</p>
<h3 id="determination-of-excessive-gyro-bias">Determination of Excessive Gyro Bias</h3>
<p>Large gyro bias offsets are normally characterised by a change in the value of delta angle bias greater than 5E-4 during flight (equivalent to ~3 deg/sec) and can also cause a large increase in the magnetometer test ratio if the yaw axis is affected. Height is normally unaffected other than extreme cases. Switch on bias value of up to 5 deg/sec can be tolerated provided the filter is given time time settle before flying . Pre-flight checks performed by the commander should prevent arming if the position is diverging.</p>
<p>(insert example plots showing bad gyro bias here)</p>
<h3 id="determination-of-poor-yaw-accuracy">Determination of Poor Yaw Accuracy</h3>
<p>Bad yaw alignment causes a velocity test ratio that increases rapidly when the vehicle starts moving due inconsistency in the direction of velocity calculated by the inertial nav and the  GPS measurement. Magnetometer innovations are slightly affected. Height is normally unaffected.</p>
<p>(insert example plots showing bad yaw alignment here)</p>
<h3 id="determination-of-poor-gps-accuracy">Determination of Poor GPS Accuracy</h3>
<p>Poor GPS accuracy is normally accompanied by a rise in the reported velocity error of the receiver in conjunction with a rise in innovations. Transient errors due to multipath, obscuration and interference are more common causes. Here is an example of a temporary loss of GPS accuracy where the multi-rotor started drifting away from its loiter location and had to be corrected using the sticks. The rise in <a href="https://github.com/PX4/Firmware/blob/master/msg/estimator_status.msg" target="_blank">estimator_status</a>.vel_test_ratio to greater than 1 indicates the GPs velocity was inconsistent with other measurements and has been rejected.</p>
<p><img src="../../assets/ecl/gps_glitch_-_test_ratios.png" alt=""></p>
<p>This is accompanied with rise in the GPS receivers reported velocity accuracy which indicates that it was likely a GPS error.<br><img src="../../assets/ecl/gps_glitch_-_reported_receiver_accuracy.png" alt=""></p>
<p>If we also look at the GPS horizontal velocity innovations and innovation variances, we can see the large spike in North velocity innovation that accompanies this GPS &apos;glitch&apos; event.<br><img src="../../assets/ecl/gps_glitch_-_velocity_innovations.png" alt=""></p>
<h3 id="determination-of-gps-data-loss">Determination of GPS Data Loss</h3>
<p>Loss of GPS data will be shown by the velocity and position innvoation test ratios &apos;flat-lining&apos;. If this occurs, check the oher GPS status data in vehicle_gps_position for further information.</p>
<p>(insert example plots showing loss of GPS data here)</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../qgc/video_streaming_wifi_broadcast.html" class="navigation navigation-prev " aria-label="Previous page: 장거리 비디오 스트리밍">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="pre_flight_checks.html" class="navigation navigation-next " aria-label="Next page: 비행전 체크">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"ecl EKF","level":"1.10.5","depth":2,"next":{"title":"비행전 체크","level":"1.10.6","depth":2,"path":"tutorials/pre_flight_checks.md","ref":"tutorials/pre_flight_checks.md","articles":[]},"previous":{"title":"장거리 비디오 스트리밍","level":"1.10.4","depth":2,"path":"qgc/video_streaming_wifi_broadcast.md","ref":"qgc/video_streaming_wifi_broadcast.md","articles":[]},"dir":"ltr"},"config":{"plugins":["youtube","richquotes","collapsible-menu","-anchors","page-toc-button","mermaid","-mermaid-2","ga","language-picker","custom-favicon","bulk-redirect@git+https://github.com/Dronecode/gitbook-plugin-bulk-redirect.git","toolbar@git+https://github.com/hamishwillee/gitbook-plugin-toolbar.git","validate-links","mathjax@git+https://github.com/Dronecode/plugin-mathjax.git#update_cdn","-stub-out-blocks@git+https://github.com/hamishwillee/gitbook-plugin-stub-out-blocks.git","theme-dronecode@git+https://github.com/dronecode/theme-dronecode.git"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"theme-dronecode":{"logo":{"logo_large":"gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_full.png","logo_small":"gitbook-plugin-theme-dronecode/images/dronecode_top_bar_logo_small.png","url":"https://www.dronecode.org/"}},"validate-links":{"defaultScheme":"https","local":"warn","remote":"disabled"},"collapsible-menu":{},"language-picker":{"grid-columns":3},"youtube":{},"search":{},"mermaid":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"language-redirect":{"baseurl":"https://dev.px4.io/"},"fontsettings":{"theme":"white","family":"sans","size":2},"richquotes":{"tip":{"alert":"success","picto":"fa-thumbs-o-up"}},"highlight":{},"favicon":"favicon.ico","page-toc-button":{},"bulk-redirect":{"basepath":"/","redirectsFile":"redirects.json"},"custom-favicon":{},"mathjax":{"forceSVG":false,"version":"2.7.1"},"ga":{"configuration":"auto","token":"UA-33658859-3"},"toolbar":{"buttons":[{"label":"Bug tracker","icon":"fa fa-bug","position":"left","url":"https://github.com/PX4/Devguide/issues/new?title=Doc+Bug:+{{title}}&body=DESCRIBE+PROBLEM+WITH+DOCS+HERE%0A%0ABug+Page:+[{{title}}]({{url}})"},{"label":"GitHub","icon":"fa fa-github","url":"https://github.com/PX4/Devguide"},{"label":"Edit page on github","icon":"fa fa-pencil-square-o","position":"left","url":"https://github.com/PX4/Devguide/edit/master/{{filepath_lang}}"}]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"logo":"./assets/site/logo_pro_small.png"},"title":"PX4 Developer Guide","language":"kr","gitbook":"*"},"file":{"path":"tutorials/tuning_the_ecl_ekf.md","mtime":"2018-08-17T01:53:58.534Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-08-17T01:55:41.324Z"},"basePath":"..","book":{"language":"kr"}});
        });
    </script>
</div>

    

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-toolbar/buttons.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

